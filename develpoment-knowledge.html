<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בסיס ידע - מתודולוגיה חח"י</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SheetJS for Excel preview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Tippy.js for tooltips -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.7/tippy.umd.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'hebrew': ['Assistant', 'ui-sans-serif', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    colors: {
                        'ms-blue': '#0078D4',
                        'ms-blue-dark': '#005A9E',
                        'ms-surface': '#fafafa',
                        'ms-border': '#e1e1e1',
                    }
                }
            }
        }
    </script>
    <style>
        .font-hebrew {
            font-family: 'Assistant', ui-sans-serif, system-ui, -apple-system, sans-serif;
        }

        /* Heading Styles */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Assistant', ui-sans-serif, system-ui, -apple-system, sans-serif;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 1rem;
            margin-top: 2rem;
            color: #1f2937;
        }

        h1 {
            font-size: 2.25rem; /* 36px */
            font-weight: 700;
            color: #0078D4;
            border-bottom: 3px solid #0078D4;
            padding-bottom: 0.5rem;
            margin-top: 0;
        }

        h2 {
            font-size: 1.875rem; /* 30px */
            font-weight: 650;
            color: #005A9E;
            border-bottom: 2px solid #e1e1e1;
            padding-bottom: 0.375rem;
        }

        h3 {
            font-size: 1.5rem; /* 24px */
            font-weight: 600;
            color: #374151;
        }

        h4 {
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: #4b5563;
        }

        h5 {
            font-size: 1.125rem; /* 18px */
            font-weight: 600;
            color: #6b7280;
        }

        h6 {
            font-size: 1rem; /* 16px */
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* First heading in content area */
        .content > h1:first-child,
        .section > h1:first-child {
            margin-top: 0;
        }

        /* Custom styles from original */
        .highlight {
            background-color: #ffeb3b;
            padding: 2px;
            border-radius: 2px;
            transition: background-color 0.5s;
        }

        .node {
            transition: all 0.3s ease;
        }

        .node:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .arrow-down {
            position: relative;
            height: 30px;
        }

        .arrow-down:after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            right: 50%;
            width: 2px;
            background: #4b5563;
        }

        .arrow-down:before {
            content: '';
            position: absolute;
            bottom: 0;
            right: calc(50% - 5px);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid #4b5563;
        }

        .approval-state {
            position: relative;
            padding-right: 20px;
        }

        .approval-state:before {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .approval-state.pending:before {
            background-color: #f59e0b;
        }

        .approval-state.approved:before {
            background-color: #10b981;
        }

        .approval-state.rejected:before {
            background-color: #ef4444;
        }

        .highlight-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        /* Apply styles to all <a href> links, except those inside navigation */
        a[href]:not(.section-link):not(.nav-link):not(.text-ms-blue) {
            display: inline;
            padding: 2px 6px;
            background: linear-gradient(135deg, #0078D4, #005A9E);
            color: #fff !important;
            font-weight: bold;
            font-size: 14px;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s ease-in-out;
            white-space: nowrap;
        }

        a[href]:not(.section-link):not(.nav-link):not(.text-ms-blue):hover {
            background: linear-gradient(135deg, #005A9E, #003E6E);
        }

        /* Table styles */
        table {
            width: 100%;
            max-width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th,
        td {
            padding: 0.75rem;
            border: 1px solid var(--ms-border);
            text-align: right;
        }

        th {
            background-color: var(--ms-blue);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e3f2fd;
        }

        /* Code blocks */
        .code-block,
        pre {
            display: block;
            width: 100%;
            max-width: 100%;
            margin: 1.5rem 0;
            overflow-x: auto;
            background-color: #f8f9fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            position: relative;
        }

        .code-block pre,
        pre {
            margin: 0;
            padding: 1rem;
            white-space: pre;
            overflow: visible;
            min-width: min-content;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            tab-size: 2;
        }

        .code-block code,
        pre code {
            display: block;
            color: #24292e;
            font-size: inherit;
            direction: ltr;
            word-wrap: normal;
            word-break: normal;
        }

        /* Note styles */
        .note {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #634b03;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Images */
        .content img,
        .img {
            width: 100%;
            height: auto;
            max-width: 800px;
            display: block;
            margin: 1.5rem auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            transition: transform 0.3s ease;
            border: 2px solid var(--ms-blue);
        }

        .content img:hover,
        .img:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        /* Section visibility */
        /* Chapter sections visibility */
        .chapter-section {
            display: none !important;
        }

        .chapter-section.active {
            display: block !important;
        }

        /* Make sure nested sections within active chapters are visible */
        .chapter-section.active .section {
            display: block !important;
        }

        /* Excel Modal Styles */
        .excel-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .excel-modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 20px;
            border: none;
            border-radius: 10px;
            width: 95%;
            height: 90%;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            direction: rtl;
        }

        .excel-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--ms-blue);
        }

        .excel-modal-title {
            color: var(--ms-blue);
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }

        .excel-modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .excel-modal-close:hover {
            color: #333;
            background-color: #f0f0f0;
        }

        .excel-modal-body {
            flex: 1;
            overflow: auto;
            direction: rtl;
        }

        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Segoe UI', Arial, sans-serif;
            direction: rtl;
            background: white;
        }

        .excel-table th,
        .excel-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: right;
            vertical-align: top;
            direction: rtl;
        }

        .excel-table th {
            background-color: var(--ms-blue);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .excel-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .excel-table tr:hover {
            background-color: #e3f2fd;
        }

        .excel-modal-footer {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        .excel-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .excel-btn-primary {
            background: linear-gradient(135deg, var(--ms-blue), var(--ms-blue-dark));
            color: white;
        }

        .excel-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 86, 179, 0.3);
        }

        .excel-btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .excel-btn-secondary:hover {
            background-color: #545b62;
            transform: translateY(-2px);
        }

        .excel-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: var(--ms-blue);
        }

        .excel-error {
            color: #dc3545;
            text-align: center;
            padding: 20px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            margin: 20px 0;
        }

        .sheet-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .sheet-tab {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .sheet-tab.active {
            background-color: var(--ms-blue);
            color: white;
            border-color: var(--ms-blue);
        }

        .sheet-tab:hover:not(.active) {
            background-color: #e9ecef;
        }

        /* Search Results Panel */
        .search-results {
            position: fixed;
            top: 60px;
            right: 240px;
            width: 300px;
            max-height: calc(100vh - 80px);
            background-color: white;
            border: 1px solid var(--ms-border);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 50;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-results-header {
            padding: 1rem;
            border-bottom: 1px solid var(--ms-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--ms-surface);
        }

        .search-results-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

        .search-results-close:hover {
            color: var(--ms-blue);
        }

        .search-results-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--ms-border);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background-color: var(--ms-surface);
        }

        .search-result-item strong {
            color: var(--ms-blue);
            background-color: #ffeb3b;
            padding: 1px 3px;
            border-radius: 2px;
        }

        /* Image container */
        .image-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .image-container img {
            max-width: 48%;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .search-results {
                right: 0;
                width: 100%;
                border-radius: 0;
            }

            .excel-modal-content {
                width: 98%;
                height: 95%;
                margin: 1% auto;
                padding: 15px;
            }

            .excel-table th,
            .excel-table td {
                padding: 6px 8px;
                font-size: 0.9rem;
            }

            .excel-modal-footer {
                flex-direction: column;
                gap: 10px;
            }

            .excel-btn {
                width: 100%;
                justify-content: center;
            }

            .image-container {
                flex-direction: column;
                align-items: center;
            }

            .image-container img {
                max-width: 100%;
            }
        }
    </style>
</head>

<body class="font-hebrew bg-white text-gray-900 min-h-screen grid grid-rows-[auto_1fr_auto] lg:grid-cols-[240px_1fr]"
    style="grid-template-areas: 'header header' 'sidebar main' 'footer main';">

    <header class="bg-white border-b border-ms-border px-6 py-3 flex items-center justify-between col-span-full"
        style="grid-area: header;">
        <div class="flex items-center gap-3">
            <img src="img/abra Profile Photo.png" class="w-10 h-10 rounded-full border-2 border-red-500">
            <h1 class="text-lg font-semibold">בסיס ידע - מתודולוגיה חח"י</h1>
        </div>
        <button id="mobile-menu-btn" class="lg:hidden p-2 text-gray-600 hover:text-gray-900">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                </path>
            </svg>
        </button>
    </header>

    <nav id="sidebar"
        class="bg-ms-surface border-l border-ms-border py-6 overflow-y-auto transform translate-x-full lg:translate-x-0 fixed lg:static top-0 right-0 h-full w-60 lg:w-auto z-50 transition-transform duration-300"
        style="grid-area: sidebar;">
        <!-- Search container -->
        <div class="px-4 pb-4 border-b border-ms-border mb-4">
            <input type="text" id="search" placeholder="חיפוש..."
                class="w-full px-3 py-2 border border-ms-border rounded-md focus:outline-none focus:ring-2 focus:ring-ms-blue">
            <div class="mt-2">
                <label class="flex items-center text-sm text-gray-600 cursor-pointer">
                    <input type="checkbox" id="wholeWordSearch" class="ml-2">
                    <span>חיפוש מילה שלמה בלבד</span>
                </label>
            </div>
        </div>

        <div class="space-y-1">
            <!-- 1. כללי -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn active"
                    data-chapter="general">
                    <span>1. כללי</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch1" class="chapter-sections max-h-96 overflow-hidden transition-all duration-300">
                    <a href="#intro"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all active"
                        data-section="intro">1.1 מבוא</a>
                    <a href="#project-structure"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="project-structure">1.2 מבנה הפרויקט</a>
                    <a href="#environments"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="environments">1.3 סביבות עבודה</a>
                    <a href="#version-control"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="version-control">1.4 ניהול גרסאות</a>
                </div>
            </div>

            <!-- 2. מתודולוגיית פיתוח -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn"
                    data-chapter="dev-methodology">
                    <span>2. מתודולוגיית פיתוח</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron rotate-180" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch2" class="chapter-sections max-h-0 overflow-hidden transition-all duration-300">
                    <button
                        class="chapter-toggle w-full text-right px-4 py-2 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 flex items-center justify-between"
                        data-chapter="naming-conventions">
                        <span>2.1 מוסכמות שמות</span>
                        <svg class="w-3 h-3 transform transition-transform chapter-chevron rotate-180"
                            fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    <div class="chapter-sections max-h-0 overflow-hidden transition-all duration-300 pr-4">
                        <a href="#general-rules"
                            class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                            data-section="general-rules">2.1.1 כללי</a>
                        <a href="#dataverse-fields"
                            class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                            data-section="dataverse-fields">2.1.2 שדות Dataverse</a>
                        <a href="#power-apps-components"
                            class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                            data-section="power-apps-components">2.1.3 רכיבי Power Apps</a>
                        <a href="#power-apps-createrecord"
                            class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                            data-section="power-apps-createrecord">2.1.4 Power Apps patch/submit form</a>
                    </div>
                    <a href="#architecture"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="architecture">2.2 ארכיטקטורה</a>
                    <a href="#design"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="design">2.3 עיצוב</a>
                    <a href="#app-variables"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="app-variables">2.4 משתנים באפליקציות</a>
                    <a href="#code-documentation"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="code-documentation">2.5 תיעוד קוד</a>
                    <a href="#performance"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="performance">2.6 ביצועים</a>
                </div>
            </div>

            <!-- 3. פיתוח Power Apps -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn"
                    data-chapter="power-apps-dev">
                    <span>3. פיתוח Power Apps</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron rotate-180" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch3" class="chapter-sections max-h-0 overflow-hidden transition-all duration-300">
                    <a href="#new-solution"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="new-solution">3.1 הקמת פתרון חדש</a>
                    <a href="#new-canvas-app"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="new-canvas-app">3.2 הקמת Canvas App חדש</a>
                    <a href="#new-MDA-app"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="new-MDA-app">3.3 הקמת Model Driven App חדש</a>
                    <a href="#components-info"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="components-info">3.4 סוגי קומפוננטות</a>
                    <a href="#security-roles"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="security-roles">3.5 תפקידי אבטחה</a>
                </div>
            </div>

            <!-- 4. תהליכי עבודה ואישורים -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn"
                    data-chapter="processes-approvals">
                    <span>4. תהליכי עבודה ואישורים</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron rotate-180" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch4" class="chapter-sections max-h-0 overflow-hidden transition-all duration-300">
                    <a href="#approver-table"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="approver-table">4.1 טבלת Approver</a>
                    <a href="#approver-steps"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="approver-steps">4.2 דיאגרמת סבב אישורים</a>
                    <a href="#action-center"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="action-center">4.3 Action Center</a>
                    <a href="#configuration-table"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="configuration-table">4.4 טבלת קונפיגורציה</a>
                    <a href="#workflows"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="workflows">4.5 זרימות עבודה (Flows)</a>
                    <a href="#process-completion"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="process-completion">4.6 סיום תהליך</a>
                </div>
            </div>

            <!-- 5. אבטחה וגישה -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn"
                    data-chapter="security-access">
                    <span>5. אבטחה וגישה</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron rotate-180" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch5" class="chapter-sections max-h-0 overflow-hidden transition-all duration-300">
                    <a href="#security"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="security">5.1 אבטחה והרשאות</a>
                    <a href="#document-sanitization"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="document-sanitization">5.2 הלבנת מסמכים</a>
                    <a href="#ad-groups"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="ad-groups">5.3 קבוצות AD (Entra ID)</a>
                    <a href="#row-level-security"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="row-level-security">5.4 ניהול הרשאות ברמת שורה</a>
                </div>
            </div>

            <!-- 6. תחזוקה ובקרת איכות -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn"
                    data-chapter="maintenance-qa">
                    <span>6. תחזוקה ובקרת איכות</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron rotate-180" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch6" class="chapter-sections max-h-0 overflow-hidden transition-all duration-300">
                    <a href="#backup"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="backup">6.1 גיבוי ושחזור</a>
                    <a href="#self-testing"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="self-testing">6.2 בדיקה עצמית</a>
                </div>
            </div>

            <!-- 7. ניהול ידע וצוות -->
            <div class="chapter-group">
                <button
                    class="chapter-toggle w-full text-right px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-blue-50 flex items-center justify-between chapter-nav-btn"
                    data-chapter="knowledge-team">
                    <span>7. ניהול ידע וצוות</span>
                    <svg class="w-4 h-4 transform transition-transform chapter-chevron rotate-180" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="ch7" class="chapter-sections max-h-0 overflow-hidden transition-all duration-300">
                    <a href="#task-management"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="task-management">7.1 ניהול משימות</a>
                    <a href="#communication"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="communication">7.2 תקשורת</a>
                    <a href="#onboarding"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="onboarding">7.3 הנחיות לכניסה לתפקיד</a>
                    <a href="#useful-links"
                        class="section-link block py-2 px-4 pr-8 text-sm text-gray-600 hover:text-ms-blue hover:bg-blue-50 border-r-2 border-transparent hover:border-ms-blue transition-all"
                        data-section="useful-links">7.4 לינקים שימושיים</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Search Results Panel -->
    <div class="search-results" id="searchResults">
        <div class="search-results-header">
            <h3 class="font-semibold">תוצאות חיפוש</h3>
            <button class="search-results-close" id="closeSearchResults">&times;</button>
        </div>
        <ul class="search-results-list" id="searchResultsList">
            <!-- תוצאות החיפוש יוצגו כאן -->
        </ul>
    </div>

    <main class="px-6 lg:px-12 py-8 overflow-y-auto content" style="grid-area: main;">
        <div class="max-w-5xl">
            <nav class="flex mb-6 text-sm" aria-label="breadcrumb">
                <ol class="flex items-center space-x-2 space-x-reverse">
                    <li><a href="#" class="text-ms-blue hover:underline">בסיס ידע</a></li>
                    <li class="text-gray-400">‹</li>
                    <li><a href="#" class="text-ms-blue hover:underline">Power Apps</a></li>
                    <li class="text-gray-400">‹</li>
                    <li id="current-chapter-breadcrumb" class="text-gray-900" aria-current="page">מתודולוגיה חח"י</li>
                </ol>
            </nav>

            <!-- Main content container -->
            <div id="main-content">
                <header class="mb-8">
                    <h1 class="text-3xl font-semibold mb-2 text-ms-blue">מתודולוגיה חחי - Power Apps ניהול ידע פיתוח
                    </h1>
                    <div class="text-sm text-gray-600">
                        <span>עודכן לאחרונה: 14 באוגוסט, 2025</span>
                    </div>
                </header>

                <!-- 1. כללי -->
                <div class="chapter-section active" id="general-chapter">
                    <div class="section" id="general">
                        <span class="anchor" id="general-anchor"></span>
                        <h2>1. כללי</h2>

                        <div class="section" id="intro">
                            <span class="anchor" id="intro-anchor"></span>
                            <h3>1.1 מבוא</h3>
                            <p>בסיס ידע זה מכיל את כל המידע הדרוש לפיתוח אפליקציות Power Apps בחברת החשמל. מטרתו לשמר
                                ידע, לאפשר אחידות בפיתוח ולסייע למפתחים חדשים להשתלב בעבודה.</p>
                        </div>

                        <div class="section" id="project-structure">
                            <span class="anchor" id="project-structure-anchor"></span>
                            <h3>1.2 מבנה הפרויקט</h3>
                            <img src="img/architect.png" alt="מבנה הפרויקט" class="img">
                        </div>

                        <div class="section" id="environments">
                            <span class="anchor" id="environments-anchor"></span>
                            <h3>1.3 סביבות עבודה</h3>
                            <ul>
                                <li>סביבת פיתוח: לפיתוח ובדיקות ראשוניות</li>
                                <li>סביבת QA: לבדיקות מקיפות</li>
                                <li>סביבת ייצור: לאפליקציה הסופית</li>
                            </ul>
                            <img src="img/12.png" alt="סביבות עבודה" class="img">

                            <h4>משתמשי מערכת לפי סביבות:</h4>
                            <p><strong>משתמש dev:</strong> Pplatform_D-SVC@iec.co.il<br>
                                *סיסמה*</p>
                            <p><strong>משתמש test:</strong> Pplatform_T-SVC@iec.co.il<br>
                                *סיסמה*</p>
                            <p><strong>משתמש prod:</strong> Pplatform_P-SVC@iec.co.il<br>
                                *סיסמה*</p>
                        </div>

                        <div class="section" id="version-control">
                            <span class="anchor" id="version-control-anchor"></span>
                            <h3>1.4 ניהול גרסאות</h3>
                            <ul>
                                <li>השתמשו ב-Git או בכלי ניהול גרסאות דומה</li>
                                <li>הגדירו מדיניות ברורה לענפים (branches) ומיזוגים (merges)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 2. מתודולוגיית פיתוח -->
                <div class="chapter-section" id="dev-methodology-chapter">
                    <div class="section" id="dev-methodology">
                        <span class="anchor" id="dev-methodology-anchor"></span>
                        <h2>2. מתודולוגיית פיתוח</h2>

                        <div class="section" id="naming-conventions">
                            <span class="anchor" id="naming-conventions-anchor"></span>
                            <h3>2.1 מוסכמות שמות</h3>

                            <div class="section" id="general-rules">
                                <span class="anchor" id="general-rules-anchor"></span>
                                <h4>2.1.1 כללי</h4>
                                <ul>
                                    <li>השתמשו באנגלית לכל השמות</li>
                                    <li>השתמשו ב-CamelCase לשמות שדות ורכיבים</li>
                                    <li>הימנעו מקיצורים לא סטנדרטיים</li>
                                </ul>
                            </div>

                            <div class="section" id="dataverse-fields">
                                <span class="anchor" id="dataverse-fields-anchor"></span>
                                <h4>2.1.2 שדות Dataverse</h4>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>שם השדה</th>
                                            <th>סוג שדה</th>
                                            <th>הערות</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>FirstName</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>LastName</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>FullName</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>BirthDate</td>
                                            <td>Date Only</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>EmployeeUserID</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים<br>(משתמש APIM / SAP = U7T0Q)</td>
                                        </tr>
                                        <tr>
                                            <td>EmployeeIDCard</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים<br>(תעודת זהות = 9999999)</td>
                                        </tr>
                                        <tr>
                                            <td>Gender</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>Email</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>PhoneNumber</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>Address</td>
                                            <td>Multiple Lines of Text</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>City</td>
                                            <td>Single Line of Text</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>PostalCode</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 10 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>HireDate</td>
                                            <td>Date Only</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>JobTitle</td>
                                            <td>Single Line of Text</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>Department</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>ManagerEmail</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>ManagerUserID</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                        <tr>
                                            <td>ManagerIDCard</td>
                                            <td>Single Line of Text</td>
                                            <td>מקסימום 100 תווים</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="section" id="power-apps-components">
                                <span class="anchor" id="power-apps-components-anchor"></span>
                                <h4>2.1.3 רכיבי Power Apps</h4>
                                <ul>
                                    <li>כפתורים: btn + [פעולה] (לדוגמה: btnSubmit, btnCancel)</li>
                                    <li>תיבות טקסט: txt + [תיאור] (לדוגמה: txtFirstName)</li>
                                    <li>רשימות נגללות: drp + [תיאור] (לדוגמה: drpDepartment)</li>
                                    <li>טבלאות: tbl + [תיאור] (לדוגמה: tblEmployeesList)</li>
                                    <li>טפסים: frm + [תיאור] (לדוגמה: frmEmployeeDetails)</li>
                                </ul>

                                <table>
                                    <thead>
                                        <tr>
                                            <th>Control name</th>
                                            <th>Abbreviation</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Badge</td>
                                            <td>bdg</td>
                                        </tr>
                                        <tr>
                                            <td>Button</td>
                                            <td>btn</td>
                                        </tr>
                                        <tr>
                                            <td>Camera control</td>
                                            <td>cam</td>
                                        </tr>
                                        <tr>
                                            <td>Canvas</td>
                                            <td>can</td>
                                        </tr>
                                        <tr>
                                            <td>Card</td>
                                            <td>crd</td>
                                        </tr>
                                        <tr>
                                            <td>Charts</td>
                                            <td>chr</td>
                                        </tr>
                                        <tr>
                                            <td>CheckBox</td>
                                            <td>chk</td>
                                        </tr>
                                        <tr>
                                            <td>Collection</td>
                                            <td>col</td>
                                        </tr>
                                        <tr>
                                            <td>Combo box</td>
                                            <td>cmb</td>
                                        </tr>
                                        <tr>
                                            <td>Component</td>
                                            <td>cmp</td>
                                        </tr>
                                        <tr>
                                            <td>Container</td>
                                            <td>con</td>
                                        </tr>
                                        <tr>
                                            <td>Dates</td>
                                            <td>dte</td>
                                        </tr>
                                        <tr>
                                            <td>Drop down</td>
                                            <td>drp</td>
                                        </tr>
                                        <tr>
                                            <td>Form</td>
                                            <td>frm</td>
                                        </tr>
                                        <tr>
                                            <td>Gallery</td>
                                            <td>gal</td>
                                        </tr>
                                        <tr>
                                            <td>Group</td>
                                            <td>grp</td>
                                        </tr>
                                        <tr>
                                            <td>Header</td>
                                            <td>hdr</td>
                                        </tr>
                                        <tr>
                                            <td>Html text</td>
                                            <td>htm</td>
                                        </tr>
                                        <tr>
                                            <td>Icon</td>
                                            <td>ico</td>
                                        </tr>
                                        <tr>
                                            <td>Image</td>
                                            <td>img</td>
                                        </tr>
                                        <tr>
                                            <td>Info Button</td>
                                            <td>info</td>
                                        </tr>
                                        <tr>
                                            <td>Label</td>
                                            <td>lbl</td>
                                        </tr>
                                        <tr>
                                            <td>Link</td>
                                            <td>lnk</td>
                                        </tr>
                                        <tr>
                                            <td>List box</td>
                                            <td>lst</td>
                                        </tr>
                                        <tr>
                                            <td>Microphone</td>
                                            <td>mic</td>
                                        </tr>
                                        <tr>
                                            <td>Microsoft Stream</td>
                                            <td>str</td>
                                        </tr>
                                        <tr>
                                            <td>Page section shape</td>
                                            <td>sec</td>
                                        </tr>
                                        <tr>
                                            <td>Pen Input</td>
                                            <td>pen</td>
                                        </tr>
                                        <tr>
                                            <td>Power BI Tile</td>
                                            <td>pbi</td>
                                        </tr>
                                        <tr>
                                            <td>Progress Bar</td>
                                            <td>pbar</td>
                                        </tr>
                                        <tr>
                                            <td>Rating</td>
                                            <td>rtg</td>
                                        </tr>
                                        <tr>
                                            <td>Rich text editor</td>
                                            <td>rte</td>
                                        </tr>
                                        <tr>
                                            <td>Shapes (rectangle, circle, and so on)</td>
                                            <td>shp</td>
                                        </tr>
                                        <tr>
                                            <td>Slider</td>
                                            <td>sld</td>
                                        </tr>
                                        <tr>
                                            <td>Tab List</td>
                                            <td>tbl</td>
                                        </tr>
                                        <tr>
                                            <td>Table</td>
                                            <td>tbl</td>
                                        </tr>
                                        <tr>
                                            <td>Text input</td>
                                            <td>txt</td>
                                        </tr>
                                        <tr>
                                            <td>Timer</td>
                                            <td>tmr</td>
                                        </tr>
                                        <tr>
                                            <td>Toggle</td>
                                            <td>tgl</td>
                                        </tr>
                                        <tr>
                                            <td>Video</td>
                                            <td>vid</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="section" id="power-apps-createrecord">
                                <span class="anchor" id="power-apps-createrecord-anchor"></span>
                                <h4>2.1.4 Power Apps patch/submit form</h4>

                                <p>ניתן ליצור רשומות חדשות ב-Power Apps באמצעות שתי גישות עיקריות: <code>Patch</code> או
                                    <code>SubmitForm</code>.</p>

                                <h5>שימוש ב-Patch</h5>
                                <p>הפקודה <code>Patch</code> מאפשרת שליטה מלאה על תהליך יצירת הרשומה:</p>

                                <div
                                    style="text-align: left; overflow-x: auto; background-color: #f8f9fa;  border-radius: 8px; border: 1px solid #ddd;">
                                    <pre dir="ltr" style="margin: 0;text-align: left;max-height: 50vh;"><code>/* 
                                * פונקציית Patch ליצירת רשומת הלוואה חדשה בטבלת CompanyLoan_47S
                                * הפונקציה מקבלת 3 פרמטרים:
                                * 1. טבלת היעד (CompanyLoan_47S)
                                * 2. רשומה ריקה עם ערכי ברירת מחדל
                                * 3. אובייקט עם כל השדות והערכים לרשומה החדשה
                                */
                                Patch(
                                   CompanyLoan_47S,                /* הטבלה שאליה נוספת הרשומה */
                                   Defaults(CompanyLoan_47S),      /* יוצר רשומה ריקה עם ערכי ברירת מחדל */
                                   {                               /* מגדיר את השדות והערכים לרשומה החדשה */
                                       /* פרטי ההלוואה */
                                       LoanName: glbLoan.LoanName,                           /* שם ההלוואה */
                                       LoanSum: glbLoan.LoanSum,                             /* סכום ההלוואה */
                                       PaymentsNum: Value(glbLoan.PaymentsNum),              /* מספר תשלומים (ממיר למספר) */
                                       LoanType: glbLoan.LoanType,                           /* סוג ההלוואה */
                                       LoanRelatedDate: glbLoan.LoanRelatedDate,             /* תאריך רלוונטי להלוואה */
                                       LoanComments: glbLoan.LoanComments,                   /* הערות להלוואה */
                                       LoanStatement: glbLoan.LoanStatement,                 /* הצהרת הלוואה */
                                       LoanTermsStatement: RTLFIX_Checkbox2_1.Value,         /* הצהרת תנאי הלוואה (מתיבת סימון) */
                                       SpecialRequest: glbLoan.SpecialRequest,               /* בקשה מיוחדת */
                                       
                                       /* פרטי העובד */
                                       Email: User_Info_Table.Y_EMAIL,                       /* דוא"ל העובד */
                                       Department: User_Info_Table.YHR_MAHLAKA_SHRT,         /* מחלקה */
                                       DepartmentCode: Value(User_Info_Table.MACHLAKA),      /* קוד מחלקה (ממיר למספר) */
                                       EmployeeSeniority: User_Info_Table.Vetek,             /* ותק העובד */
                                       EmployeeStanding: User_Info_Table.MAAMAD_DESC,        /* תיאור מעמד העובד */
                                       EmployeeStandingCode: Value(User_Info_Table.MAAMAD),  /* קוד מעמד העובד (ממיר למספר) */
                                       FullName: User_Info_Table.NACHN & " " & User_Info_Table.VORNA, /* שם מלא (משפחה + פרטי) */
                                       EmployeeIDCard: User_Info_Table.Id_Number,            /* מספר תעודת זהות */
                                       user_sap_id: User_Info_Table.USRID,                   /* מזהה SAP של העובד */
                                       
                                       /* בדיקות נוספות */
                                       hasLowSalaries: glbEmpLoanData.hasLowSalaries,        /* האם יש משכורות נמוכות */
                                       isLessThanSixMonthsUntilEndOfEmployment: glbEmpLoanData.isLessThanSixMonthsUntilEndOfEmployment, /* האם נותרו פחות מ-6 חודשים לסיום העסקה */
                                       
                                       /* סטטוס ופרטי השולח */
                                       LoanStatus: LookUp(Choices(CompanyLoan_47S.LoanStatus),Value=1).Value, /* קביעת סטטוס התחלתי (ערך 1) */
                                       SenderEmail: CurrentUser.workMail,                    /* דוא"ל השולח (המשתמש הנוכחי) */
                                       SenderName: CurrentUser.shemMale                      /* שם השולח (המשתמש הנוכחי) */
                                   }
                                )</code></pre>


                                </div>
                                <h4># הסבר מפורט על שורת הקוד של LoanStatus</h4>

                                <section>
                                    <h5>שורת הקוד:</h5>
                                    <pre><code>LoanStatus: LookUp(Choices(CompanyLoan_47S.LoanStatus), Value=1).Value</code></pre>
                                </section>

                                <section>
                                    <h5>למה צריך את המבנה המורכב הזה?</h5>
                                    <p>
                                        הסיבה שצריך להשתמש במבנה <code>LookUp(Choices(...))</code> היא בגלל שהשדה
                                        <strong>LoanStatus</strong> הוא מסוג <em>Option Set</em> (קבוצת אפשרויות)
                                        ב-Dataverse.
                                        ב-Dataverse, שדות מסוג Option Set מאוחסנים כערכים מספריים, אך מוצגים למשתמש
                                        כטקסט קריא.
                                    </p>
                                </section>

                                <section>
                                    <h5>איך זה עובד?</h5>
                                    <ol>
                                        <li>
                                            <code>Choices(CompanyLoan_47S.LoanStatus)</code> – מחזירה את כל האפשרויות של
                                            השדה LoanStatus. כל אפשרות כוללת את המאפיינים <code>Value</code> (מספר)
                                            ו-<code>Label</code> (טקסט).
                                        </li>
                                        <li>
                                            <code>LookUp(Choices(...), Value=1)</code> – מחפש את האפשרות שבה
                                            <code>Value</code> שווה ל-1.
                                        </li>
                                        <li>
                                            <code>.Value</code> – מחזיר את הערך שנמצא מתוך הרשומה שנבחרה.
                                        </li>
                                    </ol>
                                </section>

                                <section>
                                    <h5>למה לא מספיק לכתוב פשוט Value=1?</h5>
                                    <p>
                                        לא ניתן לשייך ישירות ערך מספרי לשדה Option Set. חובה לבחור את הערך דרך
                                        <code>Choices()</code> כדי לוודא שהקצאה מתבצעת כראוי. למשל:
                                    </p>
                                    <pre><code>LoanStatus: 1</code></pre>
                                    <p>תוביל לשגיאה, מכיוון שהמערכת לא יודעת לאיזה ערך מקודד הכוונה.</p>
                                </section>

                                <section>
                                    <h5>דוגמה מעשית</h5>
                                    <p style="text-align: right; direction: rtl;">נניח שהשדה LoanStatus כולל את
                                        האפשרויות הבאות:</p>

                                    <table style="width: 70%; margin-right: 10px; direction: rtl;">
                                        <thead>
                                            <tr>
                                                <th style="text-align: right;">ערך (Value)</th>
                                                <th style="text-align: right;">תווית (Label)</th>
                                                <th style="text-align: right;">משמעות</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="text-align: right;"><strong>1</strong></td>
                                                <td style="text-align: right;">בהמתנה לאישור</td>
                                                <td style="text-align: right;">הבקשה ממתינה לאישור מהגורם המאשר</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: right;"><strong>2</strong></td>
                                                <td style="text-align: right;">מאושר</td>
                                                <td style="text-align: right;">הבקשה אושרה לביצוע</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: right;"><strong>3</strong></td>
                                                <td style="text-align: right;">נדחה</td>
                                                <td style="text-align: right;">הבקשה נדחתה</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </section>
                                <p></p>
                                הקוד שלנו בוחר את האפשרות שבה <code>Value=1</code> – כלומר, הסטטוס ההתחלתי של ההלוואה
                                יהיה "בהמתנה לאישור".
                                </p>
                                </section>

                                <section>
                                    <h5>יתרונות המבנה הזה</h5>
                                    <ul>
                                        <li><strong>גמישות</strong>: גם אם הערכים ישתנו בעתיד, כל עוד מתייחסים נכון
                                            למבנה, הקוד יישאר תקף.</li>
                                        <li><strong>תאימות</strong>: זו הדרך המומלצת לעבודה עם Option Sets ב-Dataverse.
                                        </li>
                                        <li><strong>אימות</strong>: מוודא שהערך שנבחר תקף ונמצא ברשימת האפשרויות.</li>
                                    </ul>
                                </section>
                                <h4>שימוש ב-SubmitForm</h4>
                                <p>במקרה של שימוש בטופס שנבנה עם Form control, ניתן לשלוח את הנתונים בעזרת הפקודה
                                    <code>SubmitForm</code>. להלן המחשה של השימוש בטופס כזה:</p>

                                <div class="note">
                                    <p><strong>חשוב:</strong> בתמונה להלן, הרכיבים המסומנים באדום צריך למחוק, כיוון שהם
                                        מיותרים ועלולים להשפיע על ביצועי האפליקציה. בנוסף, יש לשנות את שמות הרכיבים
                                        לשמות עם קונבנציה מתאימה ושם עם משמעות, למשל: <code>frmLoanRequest</code> במקום
                                        <code>Form_1</code> ו-<code>btnSubmitLoan</code> במקום <code>Button_1</code>.
                                    </p>
                                </div>
                                <div class="example-image">
                                    <img src="img/power-apps-form-new.png"
                                        alt="דוגמה לשימוש ב-SubmitForm בטופס Power Apps" class="img" />
                                    <p class="caption">איור: טופס Power Apps הכולל שימוש ב-SubmitForm</p>
                                </div>
                            </div>


                        </div>

                        <div class="section" id="architecture">
                            <span class="anchor" id="architecture-anchor"></span>
                            <h3>2.2 ארכיטקטורה</h3>
                            <p>הגישה הארכיטקטונית בפיתוח מערכות Power Apps מבוססת על מספר עקרונות מרכזיים:</p>
                            <ul>
                                <li>הפרדה בין שכבת הנתונים, הלוגיקה והתצוגה</li>
                                <li>שימוש בטבלאות נתונים משותפות לחיבור בין תהליכים</li>
                                <li>בניית זרימות עבודה מודולריות ומשותפות</li>
                            </ul>
                        </div>

                        <div class="section" id="security">
                            <span class="anchor" id="security-anchor"></span>
                            <h3>5.1 אבטחה והרשאות</h3>
                            <ul>
                                <li>הגדירו מדיניות אבטחה ברמת השדה למידע רגיש</li>
                                <li>תכננו מראש רמות הרשאה שונות למשתמשים שונים</li>
                            </ul>
                        </div>

                        <div class="section" id="design">
                            <span class="anchor" id="design-anchor"></span>
                            <h3>2.3 עיצוב</h3>
                            <ul>
                                <li>להקפיד להגדיר בגובה ורוחב של רכיבים להשתמש בערך דינמי (לדוגמה: Parent.Width /2)</li>
                                <li>לבנות רכיבים בתוך Containers רספונסיביים (רוחביים ואופקיים)</li>
                                <li>לשמור על עיצוב אחיד בכל האפליקציה</li>
                                <li>להשתמש בקומפוננטות מוכנות מראש לשמירה על אחידות</li>
                            </ul>
                        </div>

                        <div class="section" id="app-variables">
                            <span class="anchor" id="app-variables-anchor"></span>
                            <h3>2.4 משתנים באפליקציות</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>שם משתנה</th>
                                        <th>סוג</th>
                                        <th>פונקציה</th>
                                        <th>תיאור</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>UserInGroup</td>
                                        <td>True/False</td>
                                        <td>קריאה לפאוור אוטומייט והחזרת תשובה</td>
                                        <td>בודק אם currentuser הוא חלק מקבוצת Entra ID</td>
                                    </tr>
                                    <tr>
                                        <td>CurrentUser</td>
                                        <td>Object (Record מ-APIM)</td>
                                        <td>מחזיק תשובה מ-APIM מי המשתמש שמחובר</td>
                                        <td>מחזיק תשובה מ-APIM מי המשתמש שמחובר</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="section" id="code-documentation">
                            <span class="anchor" id="code-documentation-anchor"></span>
                            <h3>2.5 תיעוד קוד</h3>
                            <ul>
                                <li>כתבו הערות ברורות בקוד</li>
                                <li>תיעוד ברור ומפורט ככל הניתן</li>
                                <li>במידה ומשתמשים ב-*/ לוודא שסוגרים את ההערה בצורה תקינה עם /* נוסף במקום הנכון</li>
                            </ul>
                        </div>

                        <div class="section" id="performance">
                            <span class="anchor" id="performance-anchor"></span>
                            <h3>2.6 ביצועים</h3>
                            <ul>
                                <li>הוסיפו אינדקסים לשדות שיחופשו לעתים קרובות</li>
                                <li>הסירו אובייקטים שלא בשימוש לשיפור ביצועים</li>
                                <li>השתמשו במטאטא בלשונית DATA על מנת לנקות / להסיר בסיסי נתונים שלא בשימוש</li>
                                <li>בדקו את מדדי הביצועים ב-appChecker וטפלו בבעיות</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 3. פיתוח Power Apps -->
                <div class="chapter-section" id="power-apps-dev-chapter">
                    <div class="section" id="power-apps-dev">
                        <span class="anchor" id="power-apps-dev-anchor"></span>
                        <h2>3. פיתוח Power Apps</h2>

                        <div class="section" id="new-solution">
                            <span class="anchor" id="new-solution-anchor"></span>
                            <h3>3.1 הקמת פתרון חדש</h3>
                            <p>בהקמת פתרון חדש יש לבחור את IEC כ- Publisher</p>
                            <img src="img/6.png" alt="בחירת IEC כ- Publisher">

                            <h4>טבלה חדשה - עמודות בסיס</h4>
                            <p>בכל טבלה חדשה, יש לוודא כי עמודות הבסיס הבאות מוקמות:</p>

                            <table>
                                <thead>
                                    <tr>
                                        <th>הסבר</th>
                                        <th>הגדרות</th>
                                        <th>סוג נתונים</th>
                                        <th>שם לוגי</th>
                                        <th>שם תצוגה</th>
                                        <th>#</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>ריצה אוטומטית של מספרים ללא התערבות חיצונית שלנו</td>
                                        <td>Minimum number of digits: 1<br>Seed Value: 1<br>ספירת תווים מרביים: 100</td>
                                        <td>מספר אוטומטי #</td>
                                        <td>iec_orderid</td>
                                        <td>OrderId</td>
                                        <td>1</td>
                                    </tr>
                                    <tr>
                                        <td>ריצה אוטומטית של מספרים ללא התערבות חיצונית שלנו</td>
                                        <td>Minimum number of digits: 5<br>Seed Value: 1<br>ספירת תווים מרביים: 100</td>
                                        <td>מספר אוטומטי #</td>
                                        <td>iec_runnumber</td>
                                        <td>Run Number</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td>אנחנו ממלאים ידנית מה-CurrentUser<br>שדה בשם: MailNickname</td>
                                        <td>ספירת תווים מרביים: 100</td>
                                        <td>טקסט</td>
                                        <td>iec_user_sap_id</td>
                                        <td>USER SAP ID</td>
                                        <td>3</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h4>הערות:</h4>
                            <ol>
                                <li>
                                    <p>טבלת APPROVER <strong>הקיימת</strong> אנחנו ממלאים את השדה: OrderGuid בעת יצירת
                                        שורות חדשות בטבלת APPROVER</p>
                                    <p>עם ה-GUID של הרשומה מהטבלה הראשית החדשה שלנו.</p>
                                    <p>ככה אנחנו יוצרים קשר בין טבלת APPROVER לטבלה החדשה שלנו, מה שיאפשר לנו לבצע חיפוש
                                        מהיר ויעל יותר.</p>
                                </li>
                                <li>
                                    <p>כשיוצרים רשומות חדשות בטבלת APPRVOER יש לשים לב למלא את השדות:</p>
                                    <ul>
                                        <li>DeepLInk</li>
                                        <li>FormName</li>
                                        <li>IDForm</li>
                                        <li>MailSubject</li>
                                        <li>OrderGuid -- GUID נלקח מהשורה החדשה שיצרנו בטבלה הראשית של הטופס שלנו.</li>
                                        <li>OrderID</li>
                                        <li>RunNumber</li>
                                        <li>Stage</li>
                                    </ul>
                                </li>
                            </ol>

                            <h4>Stage:</h4>
                            <p>אנחנו מציגים ב-Action Center את כל הרשומות שנוצרו בטבלת Approver שהשדה STAGE = 1.</p>
                            <p>לכן, יש צורך לוודא שגם במידה <strong>ואין צורך</strong> בסבב אישורים בטופס שהקמנו יש
                                להקים שורה בטבלת APPROVER שהשדה STAGE = 1, אחרת הלקוח לא יראה את הטופס בטבלאות השונות
                                ב-ACTION CENTER.</p>
                        </div>

                        <div class="section" id="new-canvas-app">
                            <span class="anchor" id="new-canvas-app-anchor"></span>
                            <h3>3.2 הקמת Canvas App חדש</h3>
                            <p>מה צריך לעשות כאשר פותחים אפליקציה חדשה:</p>

                            <h4>1. שינוי הגדרות תצוגה</h4>
                            <p><strong>יש להגדיר את תצוגת המסך כך שתהיה רספונסיבית לכל סוגי המכשירים.</strong></p>
                            <p>לאחר לחיצה על SETTINGS יפתח החלון הבא, נלחץ על DISPLAY:</p>
                            <img src="img/7.png" alt="החלון של DISPLAY">
                            <p>נגלול מעט למטה ונשנה את הערכים הבאים:</p>
                            <ul>
                                <li>Size - 16:9 Default</li>
                                <li>Scale to fit - מסומן (מופעל)</li>
                                <li>Lock aspect ratio - מסומן (מופעל)</li>
                            </ul>
                            <p>*לאחר כל שינוי נצטרך לאשר את השינוי בחלון שיקפוץ</p>
                            <img src="img/8.png" alt="החלון של DISPLAY">

                            <h4>2. התאמת המסכים</h4>
                            <p>עבור כל מסך בנפרד יש לבצע את השינויים הבאים:</p>
                            <p>לדוגמא אם המסך הראשון ברשימה נקרא Screen1 אז נלחץ עליו ובצד ימין בהגדרות / Advanced</p>
                            <p>נחפש את השורות הבאות ונעדכן אותן:</p>

                            <ul>
                                <li>Height: App.Height</li>
                                <li>Width: App.Width</li>
                                <li>MinScreenHeight: 320</li>
                                <li>MinScreenWidth: 320</li>
                            </ul>

                            <p>לאחר השינויים יש לשמור את היישום, ללחוץ על פרסום ולרענן את דפדפן.</p>

                            <h4>3. הגדרת ניווט אוטומטי לפי סוג המכשיר</h4>
                            <p>באירוע OnStart של האפליקציה, נוסיף קוד שמזהה את סוג המכשיר ומנווט בהתאם:</p>
                            <pre>
                    If(Host.OSType = "iOS" Or Host.OSType = "Android", 
                       Navigate(Screen_Mobile_Start), 
                       Navigate(Screen_Desktop_Start))
                    </pre>
                            <p>הקוד מזהה את מערכת ההפעלה של המכשיר:</p>
                            <ul>
                                <li>אם המכשיר הוא iOS או Android - מעביר למסך התחלה למובייל שמותאם לגודל מובייל</li>
                                <li>אם המכשיר הוא Windows, Mac OS או Linux - מעביר למסך התחלה לדסקטופ</li>
                            </ul>
                            <p>הערכים האפשריים ל-Host.OSType הם: Windows, Mac OS, iOS, Android, Linux</p>
                            <p><strong>הערה חשובה:</strong> כאשר משתמשים בגישה זו של ניווט ישיר למסך מותאם מובייל, אין
                                צורך להגדיר SizeBreakpoints, מכיוון שכל מסך מתוכנן בנפרד לפי המכשיר המתאים.</p>

                            <h4>4. לשתף עם קבוצת הטסט ועם המשתמש האפליקטיבי של סביבת dev</h4>

                            <h4>5. להכניס את הלינק למערכת מעקב אחר תהליכים דיגיטליים לטופס 999</h4>
                            <img src="img/15.png" alt="מערכת מעקב תהליכים">

                            <h4>6. איך לייבא ולהשתמש בקומפוננטות</h4>
                            <p>נבחר את ה + ויוצג החלון הבא, נבחר את המסומן באדום (Import component):</p>
                            <img src="img/import_component.png" alt="ייבוא קומפוננטה">
                            <p>לאחר לחיצה על המסומן באדום יוצג החלון הבא:</p>
                            <img src="img/component_list.png" alt="רשימת קומפוננטות">
                            <p>נפתח את הראשון ברשימה -- IEC Forms Components -- FullScreen</p>
                            <p>יפתח החלון הבא:</p>
                            <img src="img/components_selection.png" alt="בחירת קומפוננטות">
                            <p>נבחר את הקומפוננטות שנרצה לייבא ע"י לחיצה על העיגול משמאל לשם ולחיצה על Import המסומן בחץ
                                אדום.</p>

                            <h4>7. להתקין את הפתרון של DropdownRtlStyles:</h4>
                            <p>מתחילים באותה צורה כמו ייבוא קומפוננטה מספריית קומפוננטות.</p>
                            <p>נבחר ב- code ואז נבחר ב- DropdownRrlStyles_Key</p>
                            <img src="img/rtlpcf.png" alt="התקנת DropdownRtlStyles">
                            <p>קומפוננטה זו הופכת את ה- comboBox וה- dropdown להיות RTL.</p>
                            <p>ניתן להכריח רכיבים להיות RTL על ידי הוספת התחילית הבאה באפליקציה ל:<br>
                                RTLFIX_</p>

                            <h4>8. ליצור קונטרול שמכיל את הצבעים, פונטים וגדלים של העיצוב.</h4>
                            <p>מומלץ ליצור קונטרול ייעודי שיכלול את כל הגדרות העיצוב הנדרשות לאפליקציה, כגון:</p>
                            <ul>
                                <li>צבעים</li>
                                <li>גדלי טקסט</li>
                                <li>סוגי פונטים</li>
                                <li>מרווחים</li>
                            </ul>
                            <p>כך ניתן יהיה לשמור על אחידות בעיצוב ולבצע שינויים בקלות מנקודה מרכזית אחת.</p>
                        </div>
                        <div class="section" id="new-MDA-app">
                            <span class="anchor" id="new-MDA-app-anchor"></span>
                            <h3>3.3 הקמת אפליקציית MDA חדשה</h3>
                            <p>בעת הקמת אפליקציית MDA חדשה, יש לוודא כי:</p>
                            <ul>
                                <li>יש להקים תפקיד אבטחה (Security Role) חדש עם השם <code>{מספר הטופס}_MDA_Access</code>
                                </li>
                                <li>יש לקשר את תפקיד האבטחה הזה למודל דריבן אפליקציה</li>
                                <li>חובה לבצע זאת כדי לאפשר ליוזרים בסביבות QA וייצור גישה לאפליקציה</li>
                                <li>מדובר בשיטת אבטחה שמקורה בעולם ה-Dynamics וחשוב לציית לה</li>
                            </ul>

                            <h4>שלבים ליצירת תפקיד אבטחה למודל דריבן אפליקציה:</h4>
                            <ol>
                                <li>היכנסו למרכז ניהול הפאואר פלטפורם (Power Platform Admin Center)</li>
                                <li>בחרו בסביבה הרלוונטית</li>
                                <li>עברו ל-Settings > Users + permissions > Security roles</li>
                                <li>לחצו על New כדי ליצור תפקיד אבטחה חדש</li>
                                <li>הגדירו את שם התפקיד בפורמט: <code>{מספר הטופס}_MDA_Access</code>, לדוגמה:
                                    <code>47_MDA_Access</code></li>
                                <li>אל תגדירו בתוך תפקיד האבטחה הרשאות לטבלאות</li>
                                <li>שמרו את התפקיד</li>
                            </ol>

                            <h4>שיוך תפקיד האבטחה לאפליקציה:</h4>
                            <ol>
                                <img src="img/michel-builds-assign-role-to-app.png" alt="שיוך תפקיד אבטחה לאפליקציה">
                                <li>פתחו את האפליקציה במודל דריבן אפ דיזיינר</li>
                                <li>בחרו באפשרות Properties</li>
                                <li>בסעיף Manage Roles, הוסיפו את תפקיד האבטחה שיצרתם</li>
                                <li>שמרו ופרסמו את האפליקציה</li>
                            </ol>

                            <div class="note">
                                <p><strong>חשוב מאוד:</strong> ללא הקמת תפקיד אבטחה ייעודי והגדרתו באפליקציה, המשתמשים
                                    בסביבות QA וייצור לא יוכלו לגשת לאפליקציה כלל, גם אם יש להם הרשאות לטבלאות עצמן.</p>
                            </div>

                            <h4>בדיקת תפקידי אבטחה:</h4>
                            <p>ניתן לבדוק אילו תפקידי אבטחה משויכים לאפליקציה בכל עת על ידי:</p>
                            <ol>
                                <li>כניסה לפתרון (Solution) המכיל את האפליקציה</li>
                                <li>בחירה באפליקציית המודל דריבן</li>
                                <li>לחיצה על "Edit" או תפריט שלוש הנקודות > Properties</li>
                                <li>בדיקת הסעיף Security Roles</li>
                            </ol>

                            <h4>שימוש בקבוצות משתמשים:</h4>
                            <p>לניהול יעיל יותר של ההרשאות, מומלץ להשתמש בקבוצות Entra ID ולשייך להן את תפקידי האבטחה,
                                במקום לשייך תפקידי אבטחה לכל משתמש בנפרד. במקרה כזה:</p>
                            <ol>
                                <li>צרו קבוצת Entra ID ייעודית לאפליקציה</li>
                                <li>שייכו את משתמשי האפליקציה לקבוצה זו</li>
                                <li>הקצו את תפקיד האבטחה <code>{מספר הטופס}_MDA_Access</code> לקבוצה</li>
                            </ol>

                        </div>
                        <div class="section" id="components-info">
                            <span class="anchor" id="components-info-anchor"></span>
                            <h3>3.4 סוגי קומפוננטות</h3>

                            <h4>Component_HD_FullScreen</h4>
                            <p>יש רק כותרת עם:</p>
                            <ul>
                                <li>תמונת חברת חשמל ללא כיתוב מטה</li>
                                <li>כותרת הניתנת לבחירת ערך ידנית</li>
                                <li>כפתור דיווח על בעיה</li>
                            </ul>
                            <p>יש מקטע עם פרטים אישיים עם:</p>
                            <ul>
                                <li>כותרות מובנות מראש ורק הערך מתחת ניתן לבחירה ידנית</li>
                            </ul>
                            <p>בנוסף יש עוד כותרת ו-2 שדות לבחירה ידנית במידה ורוצים להציג פרטים של חותם מדף קודם /
                                נתונים נוספים.</p>
                            <p>ניתן להסתרה ע"י השארת הערכים ריקים.</p>

                            <h4>Component_HD_Header&Footer</h4>
                            <p>יש כותרת עם:</p>
                            <ul>
                                <li>תמונת חברת חשמל ללא כיתוב מטה</li>
                                <li>כותרת הניתנת לבחירת ערך ידנית</li>
                                <li>כותרת משנה הניתנת לבחירת ערך ידנית</li>
                                <li>כפתור דיווח על בעיה</li>
                            </ul>
                            <p>יש שורה תחתונה עם:</p>
                            <ul>
                                <li>כפתור שליחה אשר ניתן להסתרה באופן ידני</li>
                            </ul>

                            <h4>Component_HD_FullScreen_FreeLabels</h4>
                            <p>יש רק כותרת עם:</p>
                            <ul>
                                <li>תמונת חברת חשמל ללא כיתוב מטה</li>
                                <li>כותרת הניתנת לבחירת ערך ידנית</li>
                                <li>כפתור דיווח על בעיה</li>
                            </ul>
                            <p>יש 3 מקטעים:</p>
                            <ol>
                                <li>כותרת ראשית + 8 שדות לבחירה ידנית כולל הכותרות, ניתן להסתיר ע"י השארת הערכים ריקים
                                </li>
                                <li>כותרת ראשית + 4 שדות לבחירה ידנית כולל הכותרות, ניתן להסתיר ע"י השארת הערכים ריקים
                                </li>
                                <li>כותרת ראשית + 4 שדות לבחירה ידנית כולל הכותרות, ניתן להסתיר ע"י השארת הערכים ריקים
                                </li>
                            </ol>

                            <h4>Component_HD_FullScreen_FreeLabels_Header&Footer</h4>
                            <p>יש כותרת עם:</p>
                            <ul>
                                <li>תמונת חברת חשמל ללא כיתוב מטה</li>
                                <li>כותרת הניתנת לבחירת ערך ידנית</li>
                                <li>כותרת משנה הניתנת לבחירת ערך ידנית</li>
                                <li>כפתור דיווח על בעיה</li>
                            </ul>
                            <p>יש שורה תחתונה עם:</p>
                            <ul>
                                <li>כפתור שליחה אשר ניתן להסתרה באופן ידני</li>
                            </ul>
                            <p>יש 3 מקטעים:</p>
                            <ol>
                                <li>כותרת ראשית + 8 שדות לבחירה ידנית כולל הכותרות, ניתן להסתיר ע"י השארת הערכים ריקים
                                </li>
                                <li>כותרת ראשית + 4 שדות לבחירה ידנית כולל הכותרות, ניתן להסתיר ע"י השארת הערכים ריקים
                                </li>
                                <li>כותרת ראשית + 4 שדות לבחירה ידנית כולל הכותרות, ניתן להסתיר ע"י השארת הערכים ריקים
                                </li>
                            </ol>

                            <h4>Component_ReportProblemPopup</h4>
                            <p>חלון דיווח על בעיה,</p>
                            <p>ערכים שאפשר למלא ידנית:</p>
                            <ul>
                                <li>Fullname</li>
                                <li>phonenumber</li>
                            </ul>
                            <p>בנוסף יש X ו- Y שמאפשרים למקום את החלון באמצע המסך בהתאם לצורך אך לא ניתן לשנות את גודל
                                החלון</p>

                            <h4>שימוש בערכים המתקבלים מקומפוננטות לצורך יצירת בקשה</h4>
                            <p>לאחר לחיצה על "שליחה" בקומפוננטה, מתקבל ממנה הערך componenetName.FooterBTN שהוא בוליאני.
                            </p>
                            <p>אותו נזין בתוך ה- default של קונטרול Toggle ואת כל הפונקציה שאנו רוצים לבצע עם שליחת
                                הבקשה נשים ב- OnChange של ה- toggle.</p>
                            <p>אותה לוגיקה נבצע גם בקומפוננטת דיווח על בעיה. הערך המתקבל ממנה הוא</p>
                            <pre>cmp_Responsive_ReportProblemPopup_1.SendPatch_ReportProblemPopup1</pre>
                            <p>ניתן לראות דוגמה לשימושיות בכל האפליקציות.</p>
                        </div>

                        <div class="section" id="security-roles">
                            <span class="anchor" id="security-roles-anchor"></span>
                            <h3>3.5 תפקידי אבטחה</h3>
                            <p>לכל תהליך יש להגדיר תפקידי אבטחה. מדובר במתן גישה לטבלת הנתונים ולא לאפליקציית POWER
                                APPS.</p>
                            <p>יש להגדיר את תפקידי האבטחה בפתרון IEC FORM - SECURITY RULES</p>
                            <img src="img/4.png" alt="תפקידי אבטחה">
                            <p>תפקידי האבטחה שיש לערוך:</p>
                            <ul>
                                <li>min priv apps use users</li>
                                <li>min prov app approvers</li>
                            </ul>
                            <p>יש לחפש את שם הטבלה החדשה ולהיכנס אליה</p>

                            <p>אנו לרוב נבחר לתת הרשאה ל-user או לא לתת הרשאה בכלל. זה תלוי בצורך הפרטני של כל תהליך.
                            </p>
                            <img src="img/5.png" alt="תפקידי אבטחה">
                            <h4>הסבר קצר:</h4>
                            <p>user: הרשאה לרשומות שהבעלות שלהם היא אותו יוזר</p>
                            <p>Organization: הרשאה לכל הרשומות בטבלה ללא הגבלה</p>

                            <div class="note">
                                <p><strong>הערה כללית:</strong> פתרון IEC FORMS מכיל זרימות עבודה ישנות מ- KPMG.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. תהליכי עבודה ואישורים -->
                <div class="chapter-section" id="processes-approvals-chapter">
                    <div class="section" id="processes-approvals">
                        <span class="anchor" id="processes-approvals-anchor"></span>
                        <h2>4. תהליכי עבודה ואישורים</h2>

                        <div class="section" id="approver-table">
                            <span class="anchor" id="approver-table-anchor"></span>
                            <h3>4.1 טבלת Approver</h3>
                            <p>טבלת הנתונים הראשית של התהליכים הדיגיטליים של חברת החשמל היא טבלת Approvers. היא מכילה את
                                כל שלבי האישור של כל תהליך. גם כאשר אנו יוצרים תהליך ללא אישורים, אנחנו נשמור את התהליך
                                בתוך טבלת approvers כתהליך שהסתיים בהצלחה.</p>

                            <p><strong>עדכון:</strong> כיום אנו משתמשים ויוצרים טבלות Approver מהסוג החדש והמורחב בשם
                                <code>Approver_{App Number}</code>, הכוללות שדות נוספים רבים לניהול מתקדם של תהליכי
                                האישור.</p>

                            <h4>הסבר על טבלת Approver הקודמת (לתיעוד היסטורי):</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>שם עמודה</th>
                                        <th>הסבר</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Request For Email</td>
                                        <td>שדה זה מכיל את כתובת האימייל של העובד עבורו הבקשה נוצרת.
                                            השדה מאפשר לזהות מי הוא העובד שבשמם מגישים את הבקשה, גם אם השולח בפועל הוא אדם אחר.</td>
                                    </tr>
                                    <tr>
                                        <td>Request For Name</td>
                                        <td>שדה זה מכיל את שמו המלא של העובד עבורו הוגשה הבקשה.
                                            השדה משמש להצגה ברורה ומיידית של זהות בעל הבקשה האמיתי בתהליכים שבהם מגיש הבקשה אינו העובד עצמו.</td>
                                    </tr>
                                    <tr>
                                        <td>OrderID</td>
                                        <td>מספר OrderID של הרשומה בטבלת הנתונים המקורית של התהליך</td>
                                    </tr>
                                    <tr>
                                        <td>OrderGuid</td>
                                        <td>המזהה הייחודי של הרשומה בטבלת הנתונים המקורית של התהליך- העמודה עם אותו השם
                                            של הטבלה.<br><br>
                                            ככה אנחנו יוצרים קשר בין טבלת APPROVER לטבלה החדשה שלנו, מה שיאפשר לנו לבצע
                                            חיפוש מהיר ויעל יותר.</td>
                                    </tr>
                                    <tr>
                                        <td>URLDeepLink</td>
                                        <td>קישור לאפליקציית התהליך עם ה-GUID של הרשומה ב- Approvers</td>
                                    </tr>
                                    <tr>
                                        <td>Active</td>
                                        <td>הרשומה הפעילה בכל תהליך אישור. אם התהליך מאושר, אז כל הרשומות יהיו false
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>ApproveStatus</td>
                                        <td>סטטוס הרשומה הנוכחית. האם המאשר אישר/דחה/ממתין לאישור</td>
                                    </tr>
                                    <tr>
                                        <td>AppStatus</td>
                                        <td>סטטוס התהליך- התוצאה הסופית או הסטטוס הכללי של כל התהליך. אם יש רשומה אחת
                                            שאושרה ורשומה אחת שמחכה לאישור, ה-AppStatus של שתיהן יהיה ממתין
                                            לאישור.<br><br>
                                            עמודה אוטומטית שאנו לא מכניסים אליה מידע.</td>
                                    </tr>
                                    <tr>
                                        <td>Stage</td>
                                        <td>
                                            <ol>
                                                <li>המאשר הראשון בתהליך</li>
                                                <li>המאשר השני בתהליך</li>
                                            </ol>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <h4>הסבר על טבלת Approver החדשה והמורחבת:</h4>
                            <p>הטבלה החדשה בשם <code>Approver_{App Number}</code> מספקת יכולות מתקדמות של ניהול תהליכי
                                אישור עם שדות מפורטים לכל היבט של התהליך.</p>
                            <div
                                style="display: flex; gap: 10px; align-items: center; justify-content: center; margin: 20px 0;">
                                <button class="excel-btn excel-btn-primary"
                                    onclick="previewExcel('files/‪עותק של approvers_fields-Rachely.xlsx')">
                                    <i class="fas fa-eye"></i>
                                    תצוגה מקדימה
                                </button>
                                <a href="files/‪עותק של approvers_fields-Rachely.xlsx" download>
                                    <button class="excel-btn excel-btn-secondary">
                                        <i class="fas fa-download"></i>
                                        הורד קובץ
                                    </button>
                                </a>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>שם עמודה</th>
                                        <th>הסבר</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>iec_ApproverId</td>
                                        <td>מפתח ראשי אוטומטי (GUID). דוגמה: 00000000-0000-0000-0000-000000000000</td>
                                    </tr>
                                    <tr>
                                        <td>iec_SourceRowId</td>
                                        <td>GUID של רשומת הבקשה המקושרת. דוגמה: 5a4e23d1-f3a2-40e1-b7a8-157c789e3206
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>iec_IsFinal</td>
                                        <td>שדה true/false - חיווי שזהו המאשר האחרון בתהליך</td>
                                    </tr>
                                    <tr>
                                        <td>iec_IDApp</td>
                                        <td>מזהה מספר הפתרון/אפליקציה. דוגמה: 35</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApplicationName</td>
                                        <td>שם האפליקציה לקריאות. דוגמה: HR Onboarding, Expense Approval</td>
                                    </tr>
                                    <tr>
                                        <td>iec_DeepLink</td>
                                        <td>קישור ישיר לאובייקט/ישות באפליקציה. דוגמה:
                                            https://org.crm.dynamics.com/main.aspx?appId=9c7b2ea6-d5f1-48e3-b243-7abef18d51c0&pagetype=entityrecord&etn=iec_request&id=5a4e23d1-f3a2-40e1-b7a8-157c789e3206
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>iec_ExternalId</td>
                                        <td>מזהה חיצוני למעקב בין שירותים. לדוגמה מספר מזהה של השורה מ-SAP. דוגמה:
                                            REQ-2025-05-001-HR</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproverUserId</td>
                                        <td>GUID של המשתמש המאשר. דוגמה: 7bf3ab45-e8c2-4d29-8c16-91e7c9fd03ab</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproverName</td>
                                        <td>שם המאשר לתצוגה. דוגמה: דניאל כהן, Sarah Johnson</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproverEmail</td>
                                        <td>כתובת דוא"ל לשליחת האישור. דוגמה: daniel@company.com - יכול להיות משורשר
                                            לכמה מאשרים עם פסיק מפריד</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproverRole</td>
                                        <td>תפקיד המאשר. ערכים: Manager, Director, VP, CFO, HR, Legal, IT</td>
                                    </tr>
                                    <tr>
                                        <td>iec_SubStageTitle</td>
                                        <td>שם תיאורי של תת-השלב. דוגמה: אישור מנהל ישיר, אישור תקציבי, אישור משאבי אנוש
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>iec_SubStageNumber</td>
                                        <td>סדר האישור בתהליך. דוגמה: 1, 2, 10</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproveStatus</td>
                                        <td>סטטוס הרשומה הנוכחית. ערכים: 897320000 (אושר), 897320001 (נדחה), 897320002
                                            (ממתין לאישור). ערך ברירת מחדל: ממתין לאישור</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproverDelegateId</td>
                                        <td>GUID של המאשר החלופי. דוגמה: 6ef8cd92-a7f3-4e12-b5d9-0c738f26a51c</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApproverDelegateName</td>
                                        <td>שם המאשר החלופי. דוגמה: רונית לוי, John Smith</td>
                                    </tr>
                                    <tr>
                                        <td>iec_DelegationReason</td>
                                        <td>סיבת ההאצלה</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApprovalGroupName</td>
                                        <td>שם קבוצה משוייכת. דוגמה: מחלקת שכר</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApprovalGroupId</td>
                                        <td>GUID של קבוצת אישור משותפת. דוגמה: 82a7c539-e4b2-4f67-9c1d-3a5eb28f76e4</td>
                                    </tr>
                                    <tr>
                                        <td>iec_StageNumber</td>
                                        <td>מספר השלב בתהליך. דוגמה: 1, 2, 3</td>
                                    </tr>
                                    <tr>
                                        <td>iec_StageTitle</td>
                                        <td>שם תיאורי של השלב. דוגמה: אישור מנהל ישיר, אישור תקציבי, אישור משאבי אנוש
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>iec_StatusReason</td>
                                        <td>סטטוס משני. ערכים: OnHold, InReview, Pending_Info, Final_Approval</td>
                                    </tr>
                                    <tr>
                                        <td>iec_IsMandatory</td>
                                        <td>האם האישור הכרחי. ערכים: Yes, No. ערך ברירת מחדל: Yes</td>
                                    </tr>
                                    <tr>
                                        <td>iec_Priority</td>
                                        <td>עדיפות וחשיבות האישור. ערכים: Low, Medium, High, Critical. ערך ברירת מחדל:
                                            Medium</td>
                                    </tr>
                                    <tr>
                                        <td>iec_IsRepeatable</td>
                                        <td>האם ניתן לחזור על שלב זה. ערכים: Yes, No. ערך ברירת מחדל: No</td>
                                    </tr>
                                    <tr>
                                        <td>iec_RequiresMFA</td>
                                        <td>האם דורש אימות רב-גורמי למאשר. ערכים: Yes, No. ערך ברירת מחדל: No</td>
                                    </tr>
                                    <tr>
                                        <td>iec_CommentBody</td>
                                        <td>הערות מהמאשר. דוגמה: אני מאשר את הבקשה אבל מבקש לקבל עדכון על התקדמות
                                            הפרויקט בעוד חודש</td>
                                    </tr>
                                    <tr>
                                        <td>iec_CommentedOn</td>
                                        <td>זמן הוספת ההערות. דוגמה: 2025-05-21T14:32:15Z</td>
                                    </tr>
                                    <tr>
                                        <td>iec_IsApprovalRequestSent</td>
                                        <td>האם נשלחה התראה. ערכים: Yes, No. אם תאריך שליחה מלא, אז סמן בכן אחרת לא</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApprovalRequestSentTime</td>
                                        <td>זמן התראה אחרונה. דוגמה: 2025-05-20T09:15:00Z</td>
                                    </tr>
                                    <tr>
                                        <td>iec_AttachmentReferences</td>
                                        <td>אינדיקציה האם המאשר העלה מסמכים. ערכים: Yes, No. ערך ברירת מחדל: No</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ChannelType</td>
                                        <td>ערוץ התקשורת למשלוח התראות. ערכים: Email, Teams, SMS, WhatsApp. ערך ברירת
                                            מחדל: Email</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ReadReceipt</td>
                                        <td>האם התקבל אישור קריאה. ערכים: Yes, No. ערך ברירת מחדל: No</td>
                                    </tr>
                                    <tr>
                                        <td>iec_TimeoutDate</td>
                                        <td>תאריך פקיעת תוקף. דוגמה: 2025-05-23T17:00:00Z</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ReminderCount</td>
                                        <td>מספר התזכורות שנשלחו. דוגמה: 0, 1, 3. ערך ברירת מחדל: 0</td>
                                    </tr>
                                    <tr>
                                        <td>iec_MaxReminders</td>
                                        <td>מקסימום תזכורות לשליחה. דוגמה: 2, 3, 5. ערך ברירת מחדל: 3</td>
                                    </tr>
                                    <tr>
                                        <td>iec_NextReminderDate</td>
                                        <td>מועד התזכורת הבאה. דוגמה: 2025-05-22T09:00:00Z</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ReminderInterval</td>
                                        <td>מרווח זמן בשעות בין תזכורות. דוגמה: 8, 24, 48. ערך ברירת מחדל: 24</td>
                                    </tr>
                                    <tr>
                                        <td>iec_Device</td>
                                        <td>מזהה המכשיר ממנו בוצע האישור. דוגמה: iPhone13,4-54AF76B1,
                                            Windows-PC-765DC24F</td>
                                    </tr>
                                    <tr>
                                        <td>iec_SenderEmail</td>
                                        <td>כתובת דוא"ל של המשתמש שהגיש את הבקשה או של המשתמש שעבורו הגישו את הבקשה.
                                            דוגמה: avi@iec.co.il</td>
                                    </tr>
                                    <tr>
                                        <td>iec_SenderName</td>
                                        <td>שם מלא של המשתמש שהגיש את הבקשה או של המשתמש שעבורו הגישו את הבקשה. דוגמה:
                                            אבי כהן</td>
                                    </tr>
                                    <tr>
                                        <td>iec_IndexInt</td>
                                        <td>מספר רץ אוטומטי. דוגמה: 1, 2, 3</td>
                                    </tr>
                                    <tr>
                                        <td>iec_Index</td>
                                        <td>מספר רץ אוטומטי. דוגמה: 1, 2, 3</td>
                                    </tr>
                                    <tr>
                                        <td>iec_AppStatus</td>
                                        <td>סטטוס מאוחד לתהליך - עבור אקשן סנטר. לדוגמה: במידה ושלב 1 אושר אבל 2 נדחה
                                            הערך של השדה יהיה "נדחה"</td>
                                    </tr>
                                    <tr>
                                        <td>iec_ApprovalFlowType</td>
                                        <td>סוג זרימת האישורים בשלב נתון. ערכים: טורי, מקבילי, מאשר ראשון, רוב, כולם
                                            חייבים לדחות<br><br>
                                            <strong>טורי</strong> - המאשרים מקבלים את הבקשה בזה אחר זה לפי סדר
                                            ה-ApproverOrder. כל מאשר מקבל את הבקשה רק לאחר שהקודם לו אישר.<br><br>
                                            <strong>מקבילי</strong> - כל המאשרים בשלב מקבלים את הבקשה בו-זמנית, וכולם
                                            חייבים לאשר כדי שהשלב יושלם.<br><br>
                                            <strong>מאשר ראשון</strong> - כל המאשרים בשלב מקבלים את הבקשה בו-זמנית, אבל
                                            מספיק שאחד מהם יאשר כדי שהשלב יושלם.<br><br>
                                            <strong>רוב</strong> - השלב מושלם כאשר רוב המאשרים (מעל 50%) אישרו את
                                            הבקשה.<br><br>
                                            <strong>כולם חייבים לדחות</strong> - הבקשה נדחית רק אם כל המאשרים דחו אותה.
                                            אם אפילו אחד אישר, הבקשה ממשיכה לשלב הבא.<br><br>
                                            ערך ברירת מחדל: טורי
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="section" id="approver-steps">
                            <span class="anchor" id="approver-steps-anchor"></span>
                            <h3>4.2 דיאגרמת סבב אישורים</h3>
                            <div class=" mx-auto px-4 py-8 max-w-6xl">
                                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">דיאגרמת סבב אישורים - 3
                                    מאשרים</h1>

                                <div class="relative flex flex-col items-center space-y-6">
                                    <!-- Legend -->
                                    <div class="w-full max-w-2xl mt-4 bg-white border border-gray-200 rounded-lg p-4">
                                        <h3 class="font-semibold text-gray-700 mb-2">מקרא:</h3>
                                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                            <div class="flex items-center">
                                                <span class="approval-state pending w-3 h-3 rounded-full"></span>
                                                <span class="mr-2 text-sm text-gray-600">ממתין לאישור</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="approval-state approved w-3 h-3 rounded-full"></span>
                                                <span class="mr-2 text-sm text-gray-600">אושר</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="approval-state rejected w-3 h-3 rounded-full"></span>
                                                <span class="mr-2 text-sm text-gray-600">נדחה</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Main Table Section -->
                                    <div
                                        class="node w-full max-w-2xl bg-white rounded-lg shadow-md p-6 border-2 border-blue-500">
                                        <div class="flex items-center justify-center mb-4">
                                            <i class="fas fa-table text-blue-500 text-2xl mr-2"></i>
                                            <h2 class="text-xl font-semibold text-blue-700">טבלה ראשית (Main Table)</h2>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">ID:</span>
                                                <span class="font-medium block">1001</span>
                                            </div>
                                            <div class="bg-blue-50 p-3 rounded border border-blue-200 highlight-pulse">
                                                <span class="text-blue-500 text-sm">GUID:</span>
                                                <span class="font-medium block"
                                                    title="מזהה ייחודי שמקשר בין הטבלאות">5F8D3A76-C2B1-42E9...</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">Form Name:</span>
                                                <span class="font-medium block">בקשת רכש</span>
                                            </div>

                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">Created By:</span>
                                                <span class="font-medium block">ישראל ישראלי</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn"></div>

                                    <!-- Approver Table Description -->
                                    <div class="w-full max-w-2xl text-center">
                                        <div
                                            class="inline-block bg-green-100 text-green-800 px-4 py-2 rounded-full font-semibold">
                                            <i class="fas fa-users-cog mr-2"></i>טבלת APPROVER - 3 רשומות עבור סבב
                                            אישורים
                                        </div>
                                    </div>

                                    <!-- Approver 1 -->
                                    <div
                                        class="node w-full max-w-2xl bg-white rounded-lg shadow-md p-6 border-2 border-green-500">
                                        <div class="flex items-center justify-center mb-4">
                                            <i class="fas fa-user-check text-green-500 text-2xl mr-2"></i>
                                            <h2 class="text-xl font-semibold text-green-700">מאשר 1 (Stage = 1)</h2>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">מאשר:</span>
                                                <span class="font-medium block">דן לוי</span>
                                            </div>
                                            <div class="bg-green-50 p-3 rounded border border-green-200">
                                                <span class="text-green-500 text-sm">שלב:</span>
                                                <span class="font-medium block">1</span>
                                            </div>
                                            <div class="bg-blue-50 p-3 rounded border border-blue-200">
                                                <span class="text-blue-500 text-sm">OrderGuid:</span>
                                                <span class="font-medium block"
                                                    title="מקושר לטבלה הראשית">5F8D3A76-C2B1...</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">DeepLink:</span>
                                                <span class="font-medium block">/form/1001</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">סטטוס:</span>
                                                <span class="approval-state approved font-medium block">אושר</span>
                                            </div>
                                            <div class="bg-yellow-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">AppStatus (סטטוס ראשי):</span>
                                                <span class="approval-state pending font-medium block">ממתין
                                                    לאישור</span>
                                                <p class="text-xs text-purple-400 mt-1">
                                                    זהו הסטטוס הראשי שיופיע באקשן סנטר.
                                                    <br> יתקבל כ-"אושר" רק אם כל השלבים יאושרו.
                                                    <br> אם לפחות שלב אחד נדחה – יהפוך ל-"נדחה".
                                                    <br> אחרת, ישאר "ממתין לאישור".
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn"></div>

                                    <!-- Process Steps for Approver 1 -->
                                    <div
                                        class="node w-full max-w-lg bg-gray-50 rounded-lg shadow-sm p-4 border border-gray-300">
                                        <div class="flex flex-col space-y-3">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 bg-blue-100 p-2 rounded-full">
                                                    <i class="fas fa-desktop text-blue-600"></i>
                                                </div>
                                                <div class="mr-3">
                                                    <p class="text-sm font-medium">הצגה ב-Action Center למאשר 1</p>
                                                </div>
                                            </div>
                                            <div class="w-1 h-6 bg-gray-300 mr-5"></div>
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 bg-green-100 p-2 rounded-full">
                                                    <i class="fas fa-check text-green-600"></i>
                                                </div>
                                                <div class="mr-3">
                                                    <p class="text-sm font-medium">אישור ע״י מאשר 1</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn"></div>

                                    <!-- Approver 2 -->
                                    <div
                                        class="node w-full max-w-2xl bg-white rounded-lg shadow-md p-6 border-2 border-green-500">
                                        <div class="flex items-center justify-center mb-4">
                                            <i class="fas fa-user-check text-green-500 text-2xl mr-2"></i>
                                            <h2 class="text-xl font-semibold text-green-700">מאשר 2 (Stage = 2)</h2>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">Approver:</span>
                                                <span class="font-medium block">רונית כהן</span>
                                            </div>
                                            <div class="bg-green-50 p-3 rounded border border-green-200">
                                                <span class="text-green-500 text-sm">Stage:</span>
                                                <span class="font-medium block">2</span>
                                            </div>
                                            <div class="bg-blue-50 p-3 rounded border border-blue-200">
                                                <span class="text-blue-500 text-sm">OrderGuid:</span>
                                                <span class="font-medium block"
                                                    title="מקושר לטבלה הראשית">5F8D3A76-C2B1...</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">DeepLink:</span>
                                                <span class="font-medium block">/form/1001</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">Status:</span>
                                                <span class="approval-state approved font-medium block">אושר</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">AppStatus:</span>
                                                <span class="approval-state approved font-medium block">אושר</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn"></div>

                                    <!-- Process Steps for Approver 2 -->
                                    <div
                                        class="node w-full max-w-lg bg-gray-50 rounded-lg shadow-sm p-4 border border-gray-300">
                                        <div class="flex flex-col space-y-3">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 bg-blue-100 p-2 rounded-full">
                                                    <i class="fas fa-desktop text-blue-600"></i>
                                                </div>
                                                <div class="mr-3">
                                                    <p class="text-sm font-medium">הצגה ב-Action Center למאשר 2</p>
                                                </div>
                                            </div>
                                            <div class="w-1 h-6 bg-gray-300 mr-5"></div>
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 bg-green-100 p-2 rounded-full">
                                                    <i class="fas fa-check text-green-600"></i>
                                                </div>
                                                <div class="mr-3">
                                                    <p class="text-sm font-medium">אישור ע״י מאשר 2</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn"></div>

                                    <!-- Approver 3 -->
                                    <div
                                        class="node w-full max-w-2xl bg-white rounded-lg shadow-md p-6 border-2 border-green-500">
                                        <div class="flex items-center justify-center mb-4">
                                            <i class="fas fa-user-check text-green-500 text-2xl mr-2"></i>
                                            <h2 class="text-xl font-semibold text-green-700">מאשר 3 (Stage = 3)</h2>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">Approver:</span>
                                                <span class="font-medium block">יוסי אברהם</span>
                                            </div>
                                            <div class="bg-green-50 p-3 rounded border border-green-200">
                                                <span class="text-green-500 text-sm">Stage:</span>
                                                <span class="font-medium block">3</span>
                                            </div>
                                            <div class="bg-blue-50 p-3 rounded border border-blue-200">
                                                <span class="text-blue-500 text-sm">OrderGuid:</span>
                                                <span class="font-medium block"
                                                    title="מקושר לטבלה הראשית">5F8D3A76-C2B1...</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">DeepLink:</span>
                                                <span class="font-medium block">/form/1001</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">Status:</span>
                                                <span class="approval-state pending font-medium block">ממתין
                                                    לאישור</span>
                                            </div>
                                            <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                                <span class="text-gray-500 text-sm">AppStatus:</span>
                                                <span class="approval-state pending font-medium block">ממתין
                                                    לאישור</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn"></div>

                                    <!-- Process Steps for Approver 3 -->
                                    <div
                                        class="node w-full max-w-lg bg-gray-50 rounded-lg shadow-sm p-4 border border-gray-300">
                                        <div class="flex flex-col space-y-3">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 bg-blue-100 p-2 rounded-full">
                                                    <i class="fas fa-desktop text-blue-600"></i>
                                                </div>
                                                <div class="mr-3">
                                                    <p class="text-sm font-medium">הצגה ב-Action Center למאשר 3</p>
                                                </div>
                                            </div>
                                            <div class="w-1 h-6 bg-gray-300 mr-5"></div>
                                            <div class="flex items-center opacity-50">
                                                <div class="flex-shrink-0 bg-gray-100 p-2 rounded-full">
                                                    <i class="fas fa-hourglass-half text-gray-600"></i>
                                                </div>
                                                <div class="mr-3">
                                                    <p class="text-sm font-medium">ממתין לאישור מאשר 3</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="arrow-down animate__animated animate__fadeIn opacity-30"></div>

                                    <!-- Final Approval -->
                                    <div
                                        class="node w-full max-w-lg bg-white rounded-lg shadow-md p-6 border border-gray-300 opacity-90 hover:opacity-100 transition-opacity duration-300">
                                        <div class="flex items-center justify-start space-x-4">
                                            <div class="bg-green-100 p-4 rounded-full shadow-sm">
                                                <i class="fas fa-check-double text-green-500 text-2xl"></i>
                                            </div>
                                            <div>
                                                <p class="text-xl font-semibold text-green-600">הטופס אושר סופית</p>

                                            </div>
                                        </div>
                                    </div>


                                    <!-- Explanation Note -->
                                    <div
                                        class="w-full max-w-2xl mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                        <div class="flex">
                                            <div class="flex-shrink-0">
                                                <i class="fas fa-info-circle text-yellow-500 text-xl"></i>
                                            </div>
                                            <div class="mr-3">
                                                <h3 class="font-semibold text-yellow-800">הערה חשובה:</h3>
                                                <p class="text-yellow-700 text-sm">
                                                    כל 3 הרשומות בטבלת APPROVER משתמשות באותו OrderGuid מהטבלה הראשית
                                                    כדי ליצור קישור.
                                                    ההבדל העיקרי בין הרשומות הוא ערך ה-Stage המציין את סדר האישורים (1,
                                                    2, 3) וכן ה-RunNumber המציין גם הוא את מספר האישור בסבב.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="section" id="action-center">
                                <span class="anchor" id="action-center-anchor"></span>
                                <h3>4.3 Action Center</h3>
                                <p>האפליקציה שבה כלל המשתמשים יכולים לראות אילו בקשות הם הגישו ומה הסטטוס שלהם.</p>
                                <p>אנחנו מציגים ב-Action Center את כל הרשומות שנוצרו בטבלת Approver שהשדה STAGE = 1.</p>
                                <p>לכן, יש צורך לוודא שגם במידה <strong>ואין צורך</strong> בסבב אישורים בטופס שהקמנו יש
                                    להקים שורה בטבלת APPROVER שהשדה STAGE = 1, אחרת הלקוח לא יראה את הטופס בטבלאות
                                    השונות ב-ACTION CENTER.</p>
                            </div>

                            <div class="section" id="configuration-table">
                                <span class="anchor" id="configuration-table-anchor"></span>
                                <h3>4.4 טבלת קונפיגורציה</h3>
                                <p>בתוך הפתרון של ה-action canter נחפש את האפליקציה של ה- model driven.</p>
                                <p>בטבלה זו אנו נכניס את השמות הלוגיים של הטבלה הראשית של התהליך ממנה אנו רוצים להציג
                                    נתונים + טבלה משנית שקשורה (לא חובה-רק במידה ויש צורך להציג הרחבה מטבלה שנייה).</p>
                                <p>Entity- השם של הטבלה הראשית</p>
                                <p>Related entity- השם של הטבלה המשנית</p>
                                <p>ונכניס את השדות כפי שמופיע ב-output של get a row by id בפאוור אוטומייט.<br>
                                    בסקשיון "שדות" אנו נכניס את השמות של העמודות מהטבלה הראשית (Entity) כפי שהם מופיעים
                                    ב-power automate.</p>
                                <p>בסקשיון "שדות מקושרים" אנו נכניס את השמות של העמודות מהטבלה המשנית
                                    (related-entity)<br>
                                    וליצור קשר עם מפתח שמכיר כיצד להתאים את האפליקציה לתהליך החדש.</p>
                                <p>ה- orderID הוא השדה המקשר בין טבלת Aprovers לטבלה של התהליך.</p>
                                <img src="img/3.png" alt="טבלת קונפיגורציה">
                            </div>

                            <div class="section" id="workflows">
                                <span class="anchor" id="workflows-anchor"></span>
                                <h3>4.5 זרימות עבודה (Flows)</h3>
                                <p>אנו מחלקים את זרימות העבודה ל-3 זרימות מרכזיות: Build, middle ו- final.</p>

                                <h4>Build</h4>
                                <p>בשמירת בקשה חדשה בטבלת הנתונים של התהליך, תפתח זרימת עבודה אשר תיצור את תהליך האישור
                                    בטבלת Approvers ומקים שורות מאשרים בהתאם לצורך. ניתן לראות דוגמה בזרימת העבודה
                                    Build_Stage_36.</p>

                                <h4>Middle</h4>
                                <p>זרימת העבודה מחכה לראות האם יש שורה פעילה ב-Approvers, שהשתנו בה ערכים. (Stage=1)</p>
                                <p>הזרימה תמשיך בשליחת מייל לאדם הרלוונטי ובעדכון רשומות נוספות. ניתן לראות דוגמה בזרימת
                                    העבודה Middle_Stage_36</p>

                                <h4>Final</h4>
                                <p>בסיום תהליך האישור, זרימת העבודה תופעל, תיצור קובץ סופי המופק בסיום התהליך ותשלח אותו
                                    לעובד. ניתן לראות דומה בזרימת העבודה Final_Stage_36.</p>
                                <p>בחלק מהתהליכים יש ליצור מסמך סופי שישלח לעובד.</p>

                                <h4>על מנת להעלות את המסמך לתיקיית הטמפלטיים יש:</h4>
                                <ol>
                                    <li>להתחבר לסיטריקס</li>
                                    <li>להתחבר עם המשתמש האפלקטיבי</li>
                                    <li>להכנס ל-shareppoint site של PA</li>
                                    <li>להעלות את המסמך לתיקיית: מסמכים- טמפלייט</li>
                                    <li>להמשיך עם זרימת העבודה. ניתן לראות זרימה לדוגמה ליצירת מסמך מתוך טמפלייט
                                        Final_Stage_36.</li>
                                </ol>

                                <p>בסוף כל זרימת עבודה יש להכניס את ה- scope:</p>
                                <p>Scope Failure Notifications</p>
                                <p>יש להגדיר את ה- run after ל- has failed.</p>
                                <p>מטרת הסקופ היא לשלוח מייל וליידע כי זרימת העבודה נכשלה.</p>
                                <p>יש להכניס את כל הפעולות הקודמות לתוך scope נוסף ולוודא כי קוראים לו flow.</p>
                            </div>

                            <div class="section" id="process-completion">
                                <span class="anchor" id="process-completion-anchor"></span>
                                <h3>4.6 סיום תהליך</h3>
                                <p>בכל סוף פרוייקט לפני שמעבירים את המערכת לבדיקת QA, יש להכנס לאיפיון ולכתוב הערות
                                    מפתח. המטרה היא ליצור תשתית המאפשרת לנו לשמור על אחידות פיתוח ואפשרות לעשות בדיקות
                                    QA גם על המידע עצמו ולא רק על העיצוב והפונקציונאליות.</p>

                                <h4>הערות המפתח הכוללות:</h4>
                                <h5>1. מבנה המערכת- Power Apps Canvas שמות המסכים והתפקיד שלהם. לדוגמה:</h5>
                                <ul>
                                    <li><strong>מסך ראשי:</strong> הגשת הבקשה כולל העלאת קבצים ושמירה בטבלת הנתונים.
                                    </li>
                                    <li><strong>מסך מנהל:</strong> הצגת בקשת העובד ונימוק המנהל לאישור או החזרה לעובד
                                    </li>
                                    <li><strong>מסך מרכז ליאור:</strong> הצגת בקשת העובד ונימוק המנהל ואפשרות להחלטה
                                        למרכז ליאור לאשר או להחזיר לעובד.</li>
                                </ul>

                                <h5>2. זרימות עבודה- שמות ה- Power Automate ואופן פעולתם. לדוגמה:</h5>
                                <ul>
                                    <li><strong>טריגר</strong>: יצירת רשומה חדשה בטבלת Approvers עם IDform של התהליך.
                                    </li>
                                    <li><strong>פעולות</strong>:
                                        <ul>
                                            <li>הבאת הבקשה מהטבלה המקורית.</li>
                                            <li>בדיקה האם זרימת העבודה נמצאת ב- production</li>
                                            <li>שליחת מייל למנהל הרלוונטי.</li>
                                            <li>עדכון עמודת URLDeeplink של הרשומה ב- Approvers.</li>
                                            <li>שליחת מייל לעובד.</li>
                                        </ul>
                                    </li>
                                </ul>

                                <h5>3. DB- טבלאות, עמודות וסוג הנתונים המוזנים לכל טבלה. יש לציין דוגמה של הנתון.</h5>

                                <p>שם הטבלה Employment Authorization_36</p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>שם עמודה</th>
                                            <th>דוגמה לערך</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Employment_Authorization_36</td>
                                            <td>497b4f4f-f4b5-ef11-b8e9-000d3add945e</td>
                                        </tr>
                                        <tr>
                                            <td>SenderEmail</td>
                                            <td>LIMOR.LEVIN@IEC.CO.IL</td>
                                        </tr>
                                    </tbody>
                                </table>

                                <p>שם הטבלה Approvers</p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>שם עמודה</th>
                                            <th>דוגמה לערך</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>URLDeepLink</td>
                                            <td>https://apps.powerapps.com/play/e/c287f742-2959-ecfb-8a08-95f903abcd4e/a/504246ff-5549-442f-a4e8-afe4fedcff5d?tenantId=40ed954c-3e38-4c31-858a-c768fd7a39aa&sourcetime=1733305934654&source=portal&hidenavbar=true&ApproveID=555d74ca-b5c2-ef11-b8e9-002248a253e8
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Stage</td>
                                            <td>1</td>
                                        </tr>
                                    </tbody>
                                </table>

                                <h5>4. תפקידי אבטחה- מהם תפקידי האבטחה שהוגדרו לקבוצות min priv apps use users ולקבוצת
                                    min prov app approvers. אם הוגדרו תפקידי אבטחה פרטניים בתוך זרימות העבודה, יש לציין
                                    זאת.</h5>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. אבטחה וגישה -->
                <div class="chapter-section" id="security-access-chapter">
                    <div class="section" id="security-access">
                        <span class="anchor" id="security-access-anchor"></span>
                        <h2>5. אבטחה וגישה</h2>

                        <div class="section" id="security">
                            <span class="anchor" id="security-anchor"></span>
                            <h3>5.1 אבטחה והרשאות</h3>
                            <ul>
                                <li>הגדירו מדיניות אבטחה ברמת השדה למידע רגיש</li>
                                <li>תכננו מראש רמות הרשאה שונות למשתמשים שונים</li>
                                <li>השתמשו בקבוצות AD לניהול הרשאות</li>
                            </ul>
                        </div>

                                <div class="section" id="document-sanitization">
                                    <span class="anchor" id="document-sanitization-anchor"></span>
                                    <h3>5.2 הלבנת מסמכים</h3>
                                    <p>אם שומרים קבצים בטבלת annotation אז יש פלוו שרץ ישירות ועושה להם הלבנה. הפלוו הוא
                                        OPSWAT בפתרון IEC-OPSWAT</p>
                                    <p>דוגמה לשמירת קבצים בטבלת הערות/annotaion ניתן לראות בפתרון 40 בפלו
                                        Associated_Car_Permit_UploadCarLicense</p>
                                    <p>אם שומרים קובץ בטבלה אחרת יש צורך ליצור פלוו המלבין את הקבצים.</p>
                                    <p>Associated_Car_Permit_UploadCarLicense</p>
                                    <p>יש לשמור עותק של הפלו MyStoryAttachments_14S - OPSWAT<br>
                                        ולשייך אותו לפתרון הרלוונטי. יש לשנות את הטריגר שלו שיכיל את הטבלה של הפתרון
                                        ששומר את הקובץ-</p>
                                    <p style="font-weight: bold; color: red; background-color: yellow;">גדי יוסיף עוד
                                        מידע</p>
                                </div>

                                <div class="section" id="ad-groups">
                                    <span class="anchor" id="ad-groups-anchor"></span>
                                    <h3>5.3 קבוצות AD (Entra ID)</h3>
                                    <p>עובדי פנסיה וגמל : 057725c6-10f8-47b2-8b26-ad0aa1204b14</p>
                                    <p>(בAzure DevOps בחחי במאמרי ידע יש רשימה מלאה של כל קבוצות EntraID עם הGUID שלהם)
                                    </p>
                                    <div class="image-container">
                                        <img src="img/13.png" alt="קבוצות AD (Entra ID)">
                                        <img src="img/14.png" alt="EntraID-USER">
                                    </div>
                                </div>

                                <div class="section" id="row-level-security">
                                    <span class="anchor" id="row-level-security-anchor"></span>
                                    <h3>5.4 ניהול הרשאות ברמת שורה (Row Level Security)</h3>
                                    
                                    <h4>מבנה כללי</h4>
                                    <p>לכל מערכת יש מספר טבלאות מרכזיות:</p>
                                    <ul>
                                        <li><strong>טבלת המערכת</strong> - לדוגמא: הלוואות, היריון, וכו.</li>
                                        <li><strong>טבלת המאשרים</strong> - טבלת האישורים לאותה מערכת</li>
                                        <li><strong>טבלת מסמכים</strong> - מסמכים הקשורים למערכת</li>
                                    </ul>
                                    
                                    <p>אנחנו רוצים לוודא שרק מי שקשור לשורה מסוימת יוכל לראות את השורה. להלן השלבים והכללים:</p>

                                    <h4>בעת יצירת שורה בטבלת המערכת</h4>
                                    <ol>
                                        <li><strong>שיתוף העובד:</strong> נשתף את העובד עבורו נוצרה הבקשה בטבלת המערכת בהרשאת קריאה (בהתאם לדרישה העסקית נוסיף גם הרשאת עריכה).
                                            <div class="note">
                                                <strong>חשוב:</strong> צריך לחפש לפי המייל של העובד ולא לפי יוצר השורה, כי לפעמים מרכז ליאור יוצר עבור העובד ולא העובד יוצר עבור עצמו.
                                            </div>
                                        </li>
                                        <li><strong>הגדרת בעלים לטבלת המערכת:</strong> נגדיר את הבעלים של השורה בטבלת המערכת להיות המאשר הראשון בסבב האישורים.</li>
                                        <li><strong>הגדרת בעלים לשורת המאשר הראשונה:</strong> נגדיר את הבעלים של שורת המאשר הראשונה להיות המשתמש או הקבוצה של המאשר הראשון.</li>
                                        <li><strong>שיתוף העובד בשורות האישורים:</strong> נשתף את העובד עבורו נוצרה הבקשה בהרשאת קריאה לכל שורות האישורים עבור הבקשה שלו.</li>
                                        <li><strong>שיתוף המסמכים:</strong> נשתף את המסמכים עם כל גורמי האישור הרלוונטים.</li>
                                    </ol>

                                    <h4>בכל אישור של מאשר - באוטומציה שמעבירה את הבקשה למאשר הבא</h4>
                                    <ol>
                                        <li><strong>העברת בעלות המאשר הנוכחי:</strong> נעביר את הבעלים של המאשר הנוכחי להיות המשתמש האפליקטיבי או האדמין לפי הדרישות העסקיות.</li>
                                        <li><strong>הגדרת המאשר הבא כבעלים בטבלת המערכת:</strong> נהפוך את המאשר הבא לבעלים של שורת טבלת המערכת.</li>
                                        <li><strong>הגדרת בעלים לשורת המאשר הבא:</strong> נהפוך את הבעלים של שורת המאשר הבא להיות המאשר הבא - משתמש או קבוצה.</li>
                                    </ol>

                                    <h4>בסיום תפקיד שורת Approver</h4>
                                    <p>ככל ששורת Approver סיימה את תפקידה (אושר, נדחה, בוטל) הבעלים יעבור להיות המשתמש האפליקטיבי או האדמין הנבחר לפי הדרישות העסקיות.</p>
                                    <div class="note">
                                        <strong>הערה:</strong> האדמין הנבחר (משתמש או קבוצה) ישמר כמשתנה סביבה עם השם <code>DefaultAdmin</code>
                                    </div>

                                    <h4>יישום טכני - שיתוף באוטומציה</h4>
                                    
                                    <h5>שיתוף עם הרשאת צפיה או עריכה</h5>
                                    <p>בשביל לשתף באוטומציה עם הרשאת צפיה או עריכה, יש להשתמש ב-<code>unbound</code> action.</p>

                                    <h5>שינוי בעלים של השורה</h5>
                                    <p>בשביל לשנות את הבעלים, זה נעשה בשורת יצירה או עדכון הרגילה של הטבלה:</p>
                                    
                                    <h6>אם מחליפים למשתמש:</h6>
                                    <ol>
                                        <li>יש לחפש את ה-GUID של המשתמש בתוך המשתמשים של הסביבה הנוכחית לפי המייל</li>
                                        <li>לאחר מכן לשים בנוסחה הבאה:
                                            <pre><code>Systemusers(GUID)</code></pre>
                                        </li>
                                    </ol>

                                    <h6>אם מחליפים לקבוצה:</h6>
                                    <ol>
                                        <li>יש לחפש את ה-GUID של הקבוצה המקומית בסביבה לפי ה-GUID של ה-Entra ID</li>
                                        <li>לאחר מכן לשים בנוסחה הבאה:
                                            <pre><code>teams(GUID)</code></pre>
                                        </li>
                                    </ol>

                                    <h4>דיאגרמת זרימה - דוגמה עם 2 מאשרים</h4>
                                    <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 2rem; border-radius: 10px; margin: 1.5rem 0;">
                                        <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                            <h5 style="color: #0078D4; margin: 0 0 1rem 0;">שלב 1: יצירת בקשה</h5>
                                            <table style="font-size: 0.9rem;">
                                                <tr><td><strong>טבלת המערכת</strong></td><td>בעלים: מאשר 1</td></tr>
                                                <tr><td><strong>שורת מאשר 1</strong></td><td>בעלים: מאשר 1 (משתמש/קבוצה)</td></tr>
                                                <tr><td><strong>שיתופים</strong></td><td>העובד: קריאה לטבלת המערכת ולכל שורות האישורים</td></tr>
                                            </table>
                                        </div>
                                        <div style="text-align: center; margin: 0.5rem 0;">⬇️</div>
                                        <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                            <h5 style="color: #10b981; margin: 0 0 1rem 0;">שלב 2: מאשר 1 אישר</h5>
                                            <table style="font-size: 0.9rem;">
                                                <tr><td><strong>טבלת המערכת</strong></td><td>בעלים: מאשר 2</td></tr>
                                                <tr><td><strong>שורת מאשר 1</strong></td><td>בעלים: DefaultAdmin</td></tr>
                                                <tr><td><strong>שורת מאשר 2</strong></td><td>בעלים: מאשר 2 (משתמש/קבוצה)</td></tr>
                                            </table>
                                        </div>
                                        <div style="text-align: center; margin: 0.5rem 0;">⬇️</div>
                                        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                            <h5 style="color: #10b981; margin: 0 0 1rem 0;">שלב 3: מאשר 2 אישר - תהליך הסתיים</h5>
                                            <table style="font-size: 0.9rem;">
                                                <tr><td><strong>טבלת המערכת</strong></td><td>בעלים: DefaultAdmin (או משתמש אפליקטיבי)</td></tr>
                                                <tr><td><strong>שורת מאשר 1</strong></td><td>בעלים: DefaultAdmin</td></tr>
                                                <tr><td><strong>שורת מאשר 2</strong></td><td>בעלים: DefaultAdmin</td></tr>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="note">
                                        <p><strong>שימו לב:</strong> דיאגרמה זו ממחישה את התהליך הבסיסי. בפרויקטים מורכבים יותר עם מספר מאשרים, יש לחזור על תהליך העברת הבעלות בכל שלב אישור.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. תחזוקה ובקרת איכות -->
                <div class="chapter-section" id="maintenance-qa-chapter">
                    <div class="section" id="maintenance-qa">
                        <span class="anchor" id="maintenance-qa-anchor"></span>
                        <h2>6. תחזוקה ובקרת איכות</h2>

                        <div class="section" id="backup">
                            <span class="anchor" id="backup-anchor"></span>
                            <h3>6.1 גיבוי ושחזור</h3>
                            <ul>
                                <li>הגדירו ויישמו מדיניות גיבוי ושחזור</li>
                                <li>בדקו באופן תקופתי את יכולת השחזור</li>
                                <li>במידה ועובדים על טופס קיים ויש צורך לשכפל את המסך לצורך גיבוי / השוואה יש
                                    לזכור למחוק את העותק ולהשאיר את הטופס המקורי.</li>
                            </ul>
                        </div>

                                <div class="section" id="self-testing">
                                    <span class="anchor" id="self-testing-anchor"></span>
                                    <h3>6.2 בדיקה עצמית</h3>
                                    <ul>
                                        <li>הסרת אובייקטים שלא בשימוש / לצורכי בדיקות על מנת למזער בלבול של מפתחים אחרים
                                            אשר נכנסים לטופס אחרינו ושיפור ביצועים</li>
                                        <li>לוודא שאין אזהרות / בעיות ב appChecker ותיקונם במידת הצורך.</li>
                                        <li>שימוש במטאטא בלשונית DATA על מנת לנקות / להסיר בסיסי נתונים שלא בשימוש</li>
                                        <img src="img/1.png" alt="מסך ראשי של appChecker">
                                        <li>שימוש בלשונית "ביצועים" תחת appChecker ולתקן את ההערות</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. ניהול ידע וצוות -->
                <div class="chapter-section" id="knowledge-team-chapter">
                    <div class="section" id="knowledge-team">
                        <span class="anchor" id="knowledge-team-anchor"></span>
                        <h2>7. ניהול ידע וצוות</h2>

                        <div class="section" id="task-management">
                            <span class="anchor" id="task-management-anchor"></span>
                            <h3>7.1 ניהול משימות</h3>
                            <ul>
                                <li>השתמשו בכלי לניהול משימות כמו Asana או Azure DevOps בהתאם לצורך.</li>
                                <li>Asana משמשת לניהול משימות פנימיות ודיונים בתוך הצוות, ללא חשש מהלקוח.</li>
                                <li>Azure DevOps הוא הכלי הרשמי לפתיחת באגים ותקלות טכניות הדורשות התערבות של
                                    הלקוח, במיוחד בתוך סביבת CITRIX.</li>
                                <li>ניתן להצטרף למערכת Asana דרך הזימון שנשלח לכלל המשתמשים ולנהל משימות בצורה
                                    קלה ונגישה מכל מכשיר.</li>
                                <li>חשוב להשתמש במערכת המתאימה לכל סוג משימה כדי לייעל את העבודה ולמנוע בלבול.
                                </li>
                            </ul>
                        </div>                                <div class="section" id="communication">
                                    <span class="anchor" id="communication-anchor"></span>
                                    <h3>7.2 תקשורת</h3>
                                    <ul>
                                        <li>קיימו פגישות צוות קבועות לעדכון סטטוס</li>
                                        <li>השתמשו בכלי כמו Microsoft Teams לתקשורת שוטפת</li>
                                        <li>הדיילי והתקשורת בתוך חח"ח מתקיימת ב- Webex</li>
                                    </ul>
                                </div>

                                <div class="section" id="onboarding">
                                    <span class="anchor" id="onboarding-anchor"></span>
                                    <h3>7.3 הנחיות לכניסה לתפקיד פיתוח PA</h3>
                                    <p>לצורך התחברות ראשונית למערכת, להתקשר למספר של תמיכת חברת החשמל ולקבל אימייל, שם
                                        משתמש וסיסמה.</p>
                                    <p>תמיכה חח"י: 076-8642999.</p>
                                    <p>יש צורך בהתחברות ל- authanticator של משתמש חברת החשמל, וניתן לעשות זאת רק מתוך
                                        הסיטריקס (סביבת העבודה) של חברת החשמל.</p>
                                    <p>לצורך זה יש לבצע התחברות ראשונית ל-authanticator מתוך מחשב של חבר צוות המחובר
                                        למערכת.</p>
                                    <p>הדיילי והתקשורת בתוך חח"ח מתקיימת ב- webex.</p>
                                    <p>צריך לקבל משתמש לאתר המעקב תהליכים דיגיטליים מרואי.</p>
                                    <p>העיצוב של כל התהליכים נמצא ב- figma.</p>
                                    <p>סיסמא: abra1234##</p>
                                    <p>שם משתמש: abra-iec@outlook.com</p>
                                    <p>בעיצובים בפיגמה, גודל הטקסט מופיע ב- px. במערכת ה-PA יש להמיר אותם ל-pt. מצורף
                                        לינק להמרה.<br>
                                        בטימס של היוזר של חברת החשמל, יש קבוצה בשם power apps. כל המסמכים הרלוונטים
                                        נמצאים בfiles בקבוצה.
                                    </p>
                                    <img src="img/2.png" alt="המסמכים הרלוונטים בקבוצת power apps">
                                    <p>מסמכי האיפיון שאנו עובדים עליהם נמצאים במסמכי איפיון- מסמכים בעבודה</p>
                                    <p>בקובץ "שדות עבוד תהליכים דיגיטליים" יש רשימת שמית של השדות אותם אנו מקבלים מה-
                                        apim</p>
                                    <p>יש 3 enviroments לחח"י- dev, test,prod. לכל סביבה יש משתמש אפליקטיבי.</p>
                                </div>

                                <div class="section" id="useful-links">
                                    <span class="anchor" id="useful-links-anchor"></span>
                                    <h3>7.4 לינקים שימושיים</h3>
                                    <ol>
                                        <li>מערכת מעקב תהליכים דיגיטליים
                                            <a href="https://iec-tasks-powerplatform.netlify.app/"
                                                target="_blank">https://iec-tasks-powerplatform.netlify.app/</a>
                                            <br>יש לקבל שם משתמש וסיסמא מרואי
                                        </li>
                                        <li>לינקים לטפסים ישן-
                                            <a href="https://ieconline.sharepoint.com.mcas.ms/:x:/r/sites/PowerApps/_layouts/15/Doc2.aspx?action=edit&sourcedoc=%7B43def57d-030a-48c3-b023-f2b790006391%7D&wdOrigin=TEAMS-WEB.teamsSdk_ns.rwc&wdExp=TEAMS-TREATMENT&wdhostclicktime=1724663426184&web=1"
                                                target="_blank">קישור לטפסים</a>
                                        </li>
                                        <li>המרת PX ל- PT
                                            <a href="https://cssunitconverter.vercel.app/px-to-pt"
                                                target="_blank">https://cssunitconverter.vercel.app/px-to-pt</a>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <nav class="flex justify-between mt-10 pt-6 border-t border-gray-200">
                        <button id="prev-chapter"
                            class="px-4 py-2 text-sm font-medium text-gray-400 bg-gray-100 rounded cursor-not-allowed">→
                            הפרק הקודם</button>
                        <button id="next-chapter"
                            class="px-4 py-2 text-sm font-medium text-white bg-ms-blue rounded hover:bg-ms-blue-dark transition-colors">הפרק
                            הבא ←</button>
                    </nav>
                </div>
            </div>
        </div>
    </main>

    <footer class="px-6 lg:px-12 py-6 text-xs text-gray-500 border-t border-gray-200 col-span-full"
        style="grid-area: footer;">
        © חברת החשמל 2025 - מתודולוגיה חח"י Power Apps
    </footer>

    <div id="backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize - show first chapter by default
            const firstChapter = document.querySelector('.chapter-section');
            if (firstChapter) {
                firstChapter.classList.add('active');
            }

            // Initialize navigation - Set first chapter button as active
            const firstChapterBtn = document.querySelector('.chapter-nav-btn[data-chapter="general"]');
            if (firstChapterBtn) {
                firstChapterBtn.classList.add('active');
                const chevron = firstChapterBtn.querySelector('.chapter-chevron');
                if (chevron) {
                    chevron.classList.remove('rotate-180');
                }
                const sections = firstChapterBtn.nextElementSibling;
                if (sections) {
                    sections.classList.remove('max-h-0');
                    sections.classList.add('max-h-96');
                }
            }

            // Mobile menu functionality
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('backdrop');

            if (mobileMenuBtn && sidebar && backdrop) {
                mobileMenuBtn.addEventListener('click', function () {
                    sidebar.classList.toggle('translate-x-full');
                    backdrop.classList.toggle('hidden');
                });

                backdrop.addEventListener('click', function () {
                    sidebar.classList.add('translate-x-full');
                    backdrop.classList.add('hidden');
                });
            }

            // Chapter navigation functionality
            const chapterToggles = document.querySelectorAll('.chapter-toggle');
            const chapterSections = document.querySelectorAll('.chapter-section');

            // Function to show specific chapter section
            function showChapterSection(chapterId) {
                // Hide all chapter sections
                chapterSections.forEach(section => {
                    section.classList.remove('active');
                });

                // Show the selected chapter section
                const targetSection = document.getElementById(chapterId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            }

            chapterToggles.forEach(toggle => {
                toggle.addEventListener('click', function (e) {
                    e.preventDefault();

                    // If this is a main chapter button (not sub-chapter)
                    if (this.classList.contains('chapter-nav-btn')) {
                        const chapterData = this.getAttribute('data-chapter');

                        // Show the corresponding chapter section
                        if (chapterData) {
                            const fullChapterId = chapterData + '-chapter';
                            showChapterSection(fullChapterId);

                            // Update the active state of navigation buttons
                            chapterToggles.forEach(otherToggle => {
                                if (otherToggle.classList.contains('chapter-nav-btn')) {
                                    otherToggle.classList.remove('active');
                                }
                            });
                            this.classList.add('active');
                        }

                        // Handle sidebar sections visibility
                        const chevron = this.querySelector('.chapter-chevron');
                        if (chevron) {
                            chevron.classList.toggle('rotate-180');
                        }

                        const sections = this.nextElementSibling;
                        if (sections) {
                            sections.classList.toggle('max-h-0');
                            sections.classList.toggle('max-h-96');
                        }
                    } else {
                        // Handle sub-chapter toggles
                        const chevron = this.querySelector('.chapter-chevron');
                        if (chevron) {
                            chevron.classList.toggle('rotate-180');
                        }

                        const sections = this.nextElementSibling;
                        if (sections) {
                            sections.classList.toggle('max-h-0');
                            sections.classList.toggle('max-h-96');
                        }
                    }
                });
            });

            // Section link navigation
            const sectionLinks = document.querySelectorAll('.section-link');
            sectionLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Get the section id from the href
                    const targetId = this.getAttribute('href').substring(1);

                    // Find which chapter this section belongs to
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        let chapterElement = targetElement.closest('.chapter-section');
                        if (chapterElement) {
                            // Show the chapter that contains this section
                            showChapterSection(chapterElement.id);
                        }
                    }

                    // Remove active class from all section links
                    sectionLinks.forEach(l => {
                        l.classList.remove('active', 'text-ms-blue', 'border-ms-blue');
                        l.classList.add('text-gray-600', 'border-transparent');
                    });

                    // Add active class to clicked link
                    this.classList.add('active', 'text-ms-blue', 'border-ms-blue');
                    this.classList.remove('text-gray-600', 'border-transparent');

                    // Scroll to section
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }

                    // Close mobile menu if open
                    if (window.innerWidth < 1024) {
                        sidebar.classList.add('translate-x-full');
                        backdrop.classList.add('hidden');
                    }
                });
            });

            // Chapter titles for breadcrumb
            const chapterTitles = {
                'general': 'כללי',
                'dev-methodology': 'מתודולוגיית פיתוח',
                'power-apps-dev': 'פיתוח Power Apps',
                'processes-approvals': 'תהליכי עבודה ואישורים',
                'security-access': 'אבטחה וגישה',
                'maintenance-qa': 'תחזוקה ובקרת איכות',
                'knowledge-team': 'ניהול ידע וצוות'
            };

            // Chapter order for navigation
            const chapterOrder = [
                'general',
                'dev-methodology', 
                'power-apps-dev',
                'processes-approvals',
                'security-access',
                'maintenance-qa',
                'knowledge-team'
            ];

            // Function to update breadcrumb
            function updateBreadcrumb(chapterId) {
                const breadcrumbElement = document.getElementById('current-chapter-breadcrumb');
                if (breadcrumbElement && chapterTitles[chapterId]) {
                    breadcrumbElement.textContent = chapterTitles[chapterId];
                }
            }

            // Function to update next/prev buttons
            function updateNavigationButtons(currentChapterId) {
                const prevButton = document.getElementById('prev-chapter');
                const nextButton = document.getElementById('next-chapter');
                
                if (!prevButton || !nextButton) return;

                const currentIndex = chapterOrder.indexOf(currentChapterId);
                
                // Update previous button
                if (currentIndex > 0) {
                    const prevChapterId = chapterOrder[currentIndex - 1];
                    prevButton.disabled = false;
                    prevButton.className = 'px-4 py-2 text-sm font-medium text-ms-blue bg-white border border-ms-blue rounded hover:bg-ms-surface transition-colors cursor-pointer';
                    prevButton.textContent = `→ ${chapterTitles[prevChapterId]}`;
                    
                    // Remove existing event listeners and add new one
                    const newPrevButton = prevButton.cloneNode(true);
                    prevButton.parentNode.replaceChild(newPrevButton, prevButton);
                    newPrevButton.addEventListener('click', () => {
                        navigateToChapter(prevChapterId);
                    });
                } else {
                    prevButton.disabled = true;
                    prevButton.className = 'px-4 py-2 text-sm font-medium text-gray-400 bg-gray-100 rounded cursor-not-allowed';
                    prevButton.textContent = '→ הפרק הקודם';
                }
                
                // Update next button
                if (currentIndex < chapterOrder.length - 1) {
                    const nextChapterId = chapterOrder[currentIndex + 1];
                    nextButton.disabled = false;
                    nextButton.className = 'px-4 py-2 text-sm font-medium text-white bg-ms-blue rounded hover:bg-ms-blue-dark transition-colors cursor-pointer';
                    nextButton.textContent = `${chapterTitles[nextChapterId]} ←`;
                    
                    // Remove existing event listeners and add new one
                    const newNextButton = nextButton.cloneNode(true);
                    nextButton.parentNode.replaceChild(newNextButton, nextButton);
                    newNextButton.addEventListener('click', () => {
                        navigateToChapter(nextChapterId);
                    });
                } else {
                    nextButton.disabled = true;
                    nextButton.className = 'px-4 py-2 text-sm font-medium text-gray-400 bg-gray-100 rounded cursor-not-allowed';
                    nextButton.textContent = 'הפרק הבא ←';
                }
            }

            // Function to navigate to specific chapter
            function navigateToChapter(chapterId) {
                // Find and click the corresponding navigation button
                const navButton = document.querySelector(`[data-chapter="${chapterId}"]`);
                if (navButton) {
                    // Simulate click on the navigation button
                    navButton.click();
                    
                    // Update breadcrumb and navigation buttons
                    updateBreadcrumb(chapterId);
                    updateNavigationButtons(chapterId);
                    
                    // Scroll to top of content
                    const mainContent = document.querySelector('main');
                    if (mainContent) {
                        mainContent.scrollTop = 0;
                    }
                }
            }

            // Enhanced chapter navigation with breadcrumb and button updates
            chapterToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    if (this.classList.contains('chapter-nav-btn')) {
                        const chapterData = this.getAttribute('data-chapter');
                        if (chapterData) {
                            // Update breadcrumb and navigation buttons
                            setTimeout(() => {
                                updateBreadcrumb(chapterData);
                                updateNavigationButtons(chapterData);
                            }, 100);
                        }
                    }
                });
            });

            // Initialize with first chapter
            updateBreadcrumb('general');
            updateNavigationButtons('general');

            // Variables for search
            const searchInput = document.getElementById('search');
            const searchResults = document.getElementById('searchResults');
            const searchResultsList = document.getElementById('searchResultsList');
            const closeSearchResults = document.getElementById('closeSearchResults');
            const content = document.querySelector('main') || document.querySelector('#main-content');
            const wholeWordCheckbox = document.getElementById('wholeWordSearch');

            // Debounce function for search
            function debounce(func, wait) {
                let timeout;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        func.apply(context, args);
                    }, wait);
                };
            }

            // Function to extract text nodes from the content
            function getTextNodesIn(element) {
                const textNodes = [];

                function getTextNodes(node) {
                    if (node.nodeType === 3) {
                        // Text node
                        if (node.textContent.trim() !== '') {
                            textNodes.push(node);
                        }
                    } else if (node.nodeType === 1 && !['SCRIPT', 'STYLE'].includes(node.tagName)) {
                        // Element node, recursively get text nodes
                        for (let i = 0; i < node.childNodes.length; i++) {
                            getTextNodes(node.childNodes[i]);
                        }
                    }
                }

                getTextNodes(element);
                return textNodes;
            }

            function escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
            }

            // Update your highlightText function to escape the search term
            function highlightText(node, term, wholeWord = false) {
                const text = node.textContent;
                const escapedTerm = escapeRegExp(term);

                let index = -1;
                let termLength = term.length;

                if (wholeWord) {
                    // Special handling for Hebrew text
                    const isHebrewTerm = /[\u0590-\u05FF]/.test(term);

                    if (isHebrewTerm) {
                        // For Hebrew, check if the word is surrounded by spaces or punctuation or at text boundaries
                        const hebrewWordPattern = new RegExp(`(^|\\s|[,.!?;:])${escapedTerm}($|\\s|[,.!?;:])`, 'i');
                        const match = text.match(hebrewWordPattern);
                        if (match) {
                            // Adjust index to skip the space or punctuation before the match
                            index = match.index + (match[1] && match[1].length > 0 ? match[1].length : 0);
                        }
                    } else {
                        // For non-Hebrew text, use regular word boundaries
                        const wholeWordRegex = new RegExp(`\\b${escapedTerm}\\b`, 'i');
                        const match = text.match(wholeWordRegex);
                        if (match) {
                            index = match.index;
                        }
                    }
                } else {
                    // Regular substring search (case-insensitive)
                    index = text.toLowerCase().indexOf(term.toLowerCase());
                }

                if (index !== -1) {
                    const beforeText = text.substring(0, index);
                    const matchedText = text.substring(index, index + termLength);
                    const afterText = text.substring(index + termLength);

                    const highlightSpan = document.createElement('span');
                    highlightSpan.className = 'highlight';
                    highlightSpan.textContent = matchedText;

                    const newNode = document.createElement('span');
                    newNode.appendChild(document.createTextNode(beforeText));
                    newNode.appendChild(highlightSpan);
                    newNode.appendChild(document.createTextNode(afterText));

                    node.parentNode.replaceChild(newNode, node);
                    return true;
                }
                return false;
            }

            // Function to remove highlights
            function removeHighlights() {
                // Temporarily make all chapter sections visible to remove highlights from all content
                const allChapterSections = document.querySelectorAll('.chapter-section');
                const originalDisplayStates = [];
                
                allChapterSections.forEach((section, index) => {
                    originalDisplayStates[index] = section.style.display;
                    section.style.display = 'block';
                });

                const highlights = content.querySelectorAll('.highlight');
                highlights.forEach(highlight => {
                    const parent = highlight.parentNode;
                    parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                    parent.normalize();
                });

                // Restore original display states
                allChapterSections.forEach((section, index) => {
                    section.style.display = originalDisplayStates[index];
                });
            }

            // Function to perform search and highlight results
            function performSearch(term) {
                if (!term.trim()) {
                    removeHighlights();
                    searchResults.classList.remove('show');
                    return;
                }

                const wholeWord = wholeWordCheckbox && wholeWordCheckbox.checked;

                // Remove previous highlights
                removeHighlights();

                // Temporarily make all chapter sections visible for search
                const allChapterSections = document.querySelectorAll('.chapter-section');
                const originalDisplayStates = [];
                
                allChapterSections.forEach((section, index) => {
                    originalDisplayStates[index] = section.style.display;
                    section.style.display = 'block';
                });

                // Get all text nodes in the content (now includes all sections)
                const textNodes = getTextNodesIn(content);
                const results = [];

                // Search for matches (without highlighting during search)
                textNodes.forEach(node => {
                    const text = node.textContent;
                    let index = -1;
                    
                    if (wholeWord) {
                        // Special handling for Hebrew text
                        const isHebrewTerm = /[\u0590-\u05FF]/.test(term);
                        const escapedTerm = escapeRegExp(term);

                        if (isHebrewTerm) {
                            // For Hebrew, check if the word is surrounded by spaces or punctuation or at text boundaries
                            const hebrewWordPattern = new RegExp(`(^|\\s|[,.!?;:])${escapedTerm}($|\\s|[,.!?;:])`, 'i');
                            const match = text.match(hebrewWordPattern);
                            if (match) {
                                index = match.index + (match[1] && match[1].length > 0 ? match[1].length : 0);
                            }
                        } else {
                            // For non-Hebrew text, use regular word boundaries
                            const wholeWordRegex = new RegExp(`\\b${escapedTerm}\\b`, 'i');
                            const match = text.match(wholeWordRegex);
                            if (match) {
                                index = match.index;
                            }
                        }
                    } else {
                        // Regular substring search (case-insensitive)
                        index = text.toLowerCase().indexOf(term.toLowerCase());
                    }
                    
                    if (index !== -1) {
                        // Find the section this node belongs to
                        let currentElement = node.parentNode;
                        while (currentElement && currentElement !== document.body && !currentElement.classList?.contains('section')) {
                            currentElement = currentElement.parentNode;
                        }

                        if (currentElement && currentElement.classList?.contains('section')) {
                            const sectionId = currentElement.id;
                            const sectionTitle = currentElement.querySelector('h2, h3, h4')?.textContent || 'ללא כותרת';

                            // Get context around the match
                            const context = node.parentNode?.textContent || node.textContent;
                            const contextLength = 100;
                            const termIndex = context.toLowerCase().indexOf(term.toLowerCase());
                            let contextStart = Math.max(0, termIndex - contextLength / 2);
                            let contextEnd = Math.min(context.length, termIndex + term.length + contextLength / 2);

                            // Adjust to word boundaries
                            if (contextStart > 0) {
                                while (contextStart < context.length && context[contextStart] !== ' ') {
                                    contextStart++;
                                }
                            }
                            if (contextEnd < context.length) {
                                while (contextEnd > 0 && context[contextEnd] !== ' ') {
                                    contextEnd--;
                                }
                            }

                            let contextText = context.substring(contextStart, contextEnd);
                            if (contextStart > 0) contextText = '...' + contextText;
                            if (contextEnd < context.length) contextText = contextText + '...';

                            // Highlight the search term in the context
                            const highlightedContext = contextText.replace(
                                new RegExp(`(${escapeRegExp(term)})`, 'gi'),
                                '<strong>$1</strong>'
                            );

                            // Check if we already have this section in results
                            const existingResult = results.find(r => r.sectionId === sectionId);
                            if (!existingResult && sectionId) {
                                results.push({
                                    sectionId,
                                    sectionTitle,
                                    context: highlightedContext
                                });
                            }
                        }
                    }
                });

                // Restore original display states
                allChapterSections.forEach((section, index) => {
                    section.style.display = originalDisplayStates[index];
                });

                // Now highlight the results in the visible content
                if (results.length > 0) {
                    // Add highlights to visible content
                    const visibleTextNodes = getTextNodesIn(content);
                    visibleTextNodes.forEach(node => {
                        highlightText(node, term, wholeWord);
                    });
                }

                // Display search results
                if (results.length > 0) {
                    searchResultsList.innerHTML = results.map(result =>
                        `<li class="search-result-item" data-section="${result.sectionId}">
                            <div class="font-medium text-sm mb-1">${result.sectionTitle}</div>
                            <div class="text-xs text-gray-600">${result.context}</div>
                        </li>`
                    ).join('');

                    searchResults.classList.add('show');

                    // Add click handlers for search results
                    searchResultsList.querySelectorAll('.search-result-item').forEach(item => {
                        item.addEventListener('click', function () {
                            const sectionId = this.getAttribute('data-section');
                            const section = document.getElementById(sectionId);
                            if (section) {
                                // Find which chapter this section belongs to and activate it
                                let chapterElement = section.closest('.chapter-section');
                                if (chapterElement) {
                                    // First, deactivate all chapters
                                    document.querySelectorAll('.chapter-section').forEach(ch => {
                                        ch.classList.remove('active');
                                    });
                                    
                                    // Activate the target chapter
                                    chapterElement.classList.add('active');
                                    
                                    // Update navigation to reflect active chapter
                                    const chapterId = chapterElement.id.replace('-chapter', '');
                                    const navButton = document.querySelector(`[data-chapter="${chapterId}"]`);
                                    if (navButton) {
                                        // Remove active class from all nav buttons
                                        document.querySelectorAll('.chapter-nav-btn').forEach(btn => {
                                            btn.classList.remove('active');
                                        });
                                        // Add active class to the target nav button
                                        navButton.classList.add('active');
                                        
                                        // Expand the chapter menu if it's collapsed
                                        const chevron = navButton.querySelector('.chapter-chevron');
                                        if (chevron && chevron.classList.contains('rotate-180')) {
                                            chevron.classList.remove('rotate-180');
                                            const sectionsDiv = navButton.parentNode.querySelector('.chapter-sections');
                                            if (sectionsDiv) {
                                                sectionsDiv.style.maxHeight = sectionsDiv.scrollHeight + 'px';
                                            }
                                        }
                                    }
                                }
                                
                                // Re-highlight the search term in the now-visible section
                                setTimeout(() => {
                                    removeHighlights();
                                    const newVisibleTextNodes = getTextNodesIn(content);
                                    newVisibleTextNodes.forEach(node => {
                                        highlightText(node, term, wholeWord);
                                    });
                                    section.scrollIntoView({ behavior: 'smooth' });
                                }, 100);
                                
                                searchResults.classList.remove('show');
                            }
                        });
                    });
                } else {
                    searchResultsList.innerHTML = '<li class="search-result-item">לא נמצאו תוצאות</li>';
                    searchResults.classList.add('show');
                }
            }

            // Search input event listener
            if (searchInput) {
                const debouncedSearch = debounce(function () {
                    performSearch(this.value);
                }, 300);

                searchInput.addEventListener('input', debouncedSearch);
            }

            // Close search results
            if (closeSearchResults) {
                closeSearchResults.addEventListener('click', function () {
                    searchResults.classList.remove('show');
                    removeHighlights();
                });
            }

            // Excel preview functionality
            let currentExcelFile = '';

            // Function to handle Excel file clicks
            function handleExcelClick(link, fileName) {
                if (fileName.match(/\.(xlsx|xls)$/i)) {
                    currentExcelFile = link.href;
                    showExcelPreview(link.href);
                    return false; // Prevent default link behavior
                }
                return true; // Allow normal link behavior for non-Excel files
            }

            // Add click handlers to all Excel file links
            document.querySelectorAll('a[href$=".xlsx"], a[href$=".xls"]').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const fileName = this.href.split('/').pop();
                    handleExcelClick(this, fileName);
                });
            });

            // Excel modal elements
            const modal = document.getElementById('excelModal');
            const closeModalBtns = document.querySelectorAll('#closeExcelModal, #closeExcelModalBtn');
            const downloadBtn = document.getElementById('downloadExcelBtn');
            const loadingDiv = document.getElementById('excelLoading');
            const errorDiv = document.getElementById('excelError');
            const contentDiv = document.getElementById('excelContent');
            const sheetTabsDiv = document.getElementById('sheetTabs');

            // Show Excel preview
            function showExcelPreview(fileUrl) {
                modal.style.display = 'block';
                loadingDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                contentDiv.style.display = 'none';
                sheetTabsDiv.style.display = 'none';

                fetch(fileUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.arrayBuffer();
                    })
                    .then(data => {
                        const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
                        displayExcelData(workbook);
                    })
                    .catch(error => {
                        console.error('Error loading Excel file:', error);
                        loadingDiv.style.display = 'none';
                        errorDiv.style.display = 'block';
                        errorDiv.textContent = `שגיאה בטעינת הקובץ: ${error.message}`;
                    });
            }

            // Display Excel data
            function displayExcelData(workbook) {
                loadingDiv.style.display = 'none';

                const sheetNames = workbook.SheetNames;

                if (sheetNames.length > 1) {
                    // Show sheet tabs if multiple sheets
                    sheetTabsDiv.style.display = 'block';
                    sheetTabsDiv.innerHTML = sheetNames.map((name, index) =>
                        `<button class="sheet-tab ${index === 0 ? 'active' : ''}" data-sheet="${name}">${name}</button>`
                    ).join('');

                    // Add click handlers for sheet tabs
                    sheetTabsDiv.querySelectorAll('.sheet-tab').forEach(tab => {
                        tab.addEventListener('click', function () {
                            // Remove active class from all tabs
                            sheetTabsDiv.querySelectorAll('.sheet-tab').forEach(t => t.classList.remove('active'));
                            // Add active class to clicked tab
                            this.classList.add('active');
                            // Display the selected sheet
                            displaySheet(workbook, this.getAttribute('data-sheet'));
                        });
                    });
                }

                // Display first sheet by default
                displaySheet(workbook, sheetNames[0]);
                contentDiv.style.display = 'block';
            }

            // Display specific sheet
            function displaySheet(workbook, sheetName) {
                const worksheet = workbook.Sheets[sheetName];
                const htmlTable = XLSX.utils.sheet_to_html(worksheet, {
                    table: '<table class="excel-table">',
                    editable: false
                });

                contentDiv.innerHTML = htmlTable;
            }

            // Close modal handlers
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', closeModal);
            });

            function closeModal() {
                modal.style.display = 'none';
            }

            // Download button handler
            if (downloadBtn) {
                downloadBtn.onclick = function () {
                    if (currentExcelFile) {
                        const link = document.createElement('a');
                        link.href = currentExcelFile;
                        link.download = currentExcelFile.split('/').pop();
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
            }

            // Close modal with Escape key
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            // Global function for Excel preview
            window.previewExcel = function (fileUrl) {
                currentExcelFile = fileUrl;
                showExcelPreview(fileUrl);
            };

            // Initialize tooltips if Tippy.js is available
            if (typeof tippy !== 'undefined') {
                tippy('[data-tippy-content]', {
                    theme: 'light-border',
                    placement: 'top',
                    allowHTML: true
                });
            }
        });
    </script>
    <!-- Excel Preview Modal -->
    <div id="excelModal" class="excel-modal">
        <div class="excel-modal-content">
            <div class="excel-modal-header">
                <h2 class="excel-modal-title">תצוגה מקדימה של קובץ Excel</h2>
                <button class="excel-modal-close" id="closeExcelModal">&times;</button>
            </div>
            <div class="excel-modal-body">
                <div id="excelLoading" class="excel-loading">
                    <i class="fas fa-spinner fa-spin" style="margin-left: 10px;"></i>
                    טוען קובץ...
                </div>
                <div id="excelError" class="excel-error" style="display: none;"></div>
                <div id="sheetTabs" class="sheet-tabs" style="display: none;"></div>
                <div id="excelContent" style="display: none;"></div>
            </div>
            <div class="excel-modal-footer">
                <button id="downloadExcelBtn" class="excel-btn excel-btn-primary">
                    <i class="fas fa-download"></i>
                    הורד קובץ
                </button>
                <button id="closeExcelModalBtn" class="excel-btn excel-btn-secondary">
                    <i class="fas fa-times"></i>
                    סגור
                </button>
            </div>
        </div>
    </div>
</body>

</html>